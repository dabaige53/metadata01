# 详情页类型清单（Detail Drawer / 详情抽屉）

本文档用于汇总当前系统侧边栏详情抽屉（`frontend/src/components/DetailDrawer.tsx`）支持的**详情页类型**，以及与“原始字段是否存在聚合/去重（你说的‘驱虫’）展示”相关的关键逻辑。

## 1. 详情页类型（一级资产类型）

以下类型对应 `DetailDrawer` 中 `currentItem.type` 的取值（通常为复数形式）。

| 类型标识（type） | 页面名称（UI） | 说明 |
| --- | --- | --- |
| `databases` | 数据库 | 物理数据库资产 |
| `tables` | 数据表 | **物理表**详情页（您提到的“物理表”即这里） |
| `columns` | 原始列 | 物理表的列 |
| `datasources` | 数据源 | Tableau 数据源（含嵌入式/已发布的关联展示） |
| `workbooks` | 工作簿 | Tableau 工作簿 |
| `views` | 视图 | 视图/看板（Dashboard/Worksheet） |
| `fields` | 字段 | 原始字段（Regular Field） |
| `metrics` | 指标 | 计算字段/指标（Calculated Field / Metric） |
| `projects` | 项目 | Tableau 项目 |
| `users` | 用户 | Tableau 用户 |

> 兼容性映射：当 `currentItem.type` 为单数 `field` / `metric` 时，`DetailDrawer` 会在加载时映射为 `fields` / `metrics`。

## 2. “原始字段是否还有聚合/去重（驱虫）”——答案与证据

结论：**有**。

系统在某些上下游视角下，会把“字段实例（Field Instance）”按更稳定的维度进行**分组**与**聚合**展示：

### 2.1 数据表详情页：按“原始列”分组 + 按“字段名”聚合

位置：`frontend/src/components/DetailDrawer.tsx` 的 `renderFieldsGroupedByColumn(fields)`。

逻辑要点：

1. 第一层按原始列分组：
   - 取 `upstreamColumnName` / `upstream_column_name` 作为分组 key
   - 无法关联原始列时归入 `未关联原始列`
2. 第二层在每个原始列分组内按字段名聚合：
   - 取 `f.name` 聚合为“字段名”维度
   - 同名字段会合并展示，并统计来源数据源（`via_datasource` / `datasourceName` / `datasource_name`）
3. 当原始列分组数量超过 50 时：默认折叠全部分组（减少信息噪声）。

含义（对应您的“驱虫”）：

- 同一个物理列在多个数据源/工作簿链路下可能产生多个字段实例；页面会把这些实例“聚合成一个字段条目”，避免重复刷屏。

### 2.2 数据源详情页：按“上游表”分组 + 按“原始列”分组 + 按“字段名”聚合

位置：`frontend/src/components/DetailDrawer.tsx` 的 `renderFieldsGroupedByTable(fields)`。

逻辑要点：

1. 第一层按上游表分组：
   - 取 `upstream_table_name`，无则归入 `未关联数据表`
2. 第二层按原始列分组：
   - 取 `upstream_column_name`，无则归入 `未关联原始列`
3. 第三层按字段名聚合：
   - 同名字段会聚合为一个条目，并记录来源（工作簿/数据源/是否嵌入式等）用于展开查看。

含义：

- 在“数据源→上游物理层”的视角里，字段去重的粒度更细：先按表、再按列、再把同名字段实例合并。

## 3. 相关的“聚合/重复”逻辑（非原始字段，但常被混淆）

### 3.1 指标（`metrics`）重复：同名定义 / 同定义实例

在 `DetailDrawer` 的 tabs 逻辑里，存在对指标重复的专门入口：

- `同名定义（duplicates）`：当 `data.similarMetrics` 存在时显示
- `同定义指标（instances）`：当 `type === 'metrics'` 且 `data.instances.length > 1` 时显示

这部分是“指标去重/聚合”，与“原始字段去重展示”是两条不同逻辑线。
