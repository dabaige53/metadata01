<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Tableau æ•°æ®è¡€ç¼˜å…¨æ™¯å›¾</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            min-height: 100vh;
            padding: 24px; 
            font-family: 'Inter', 'PingFang SC', -apple-system, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            padding: 32px;
            min-height: calc(100vh - 48px);
            display: flex;
            flex-direction: column;
        }
        h1 { 
            text-align: center; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0 0 24px 0; 
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ - ç»ç’ƒæ‹Ÿæ€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%);
            border: 1px solid rgba(102,126,234,0.2);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px -8px rgba(102,126,234,0.3);
        }
        .stat-val { 
            font-size: 32px; 
            font-weight: 700; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-label { 
            font-size: 13px; 
            color: #64748b; 
            margin-top: 6px;
            font-weight: 500;
        }
        
        /* å›¾ä¾‹ */
        .legend { 
            display: flex; 
            justify-content: center; 
            gap: 24px; 
            padding: 16px 24px; 
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px; 
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
        }
        .legend-item { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 13px; 
            color: #475569;
            font-weight: 500;
        }
        .dot { 
            width: 12px; 
            height: 12px; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* å›¾è¡¨å®¹å™¨ - å¢å¤§é«˜åº¦å‡å°‘é‡å  */
        #sankey-chart { 
            flex: 1;
            width: 100%; 
            min-height: 900px;
            height: 900px;
        }

        /* æœ¯è¯­å®šä¹‰ */
        .glossary {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }
        .glossary h2 { 
            font-size: 18px; 
            margin-bottom: 16px; 
            color: #1e293b;
            font-weight: 600;
        }
        .glossary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }
        .glossary-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s ease;
        }
        .glossary-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .glossary-title {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #334155;
        }
        .glossary-desc {
            font-size: 12px;
            color: #64748b;
            line-height: 1.5;
        }
        .badge {
            padding: 3px 8px;
            border-radius: 6px;
            color: white;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-healthy { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .badge-embedded { background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%); }
        .badge-orphan { background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%); }
        .badge-broken { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
    </style>
</head>
<body>
    <div class="container">
        <h1>Tableau æ•°æ®èµ„äº§è¡€ç¼˜æµå‘å›¾</h1>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-val">6</div>
                <div class="stat-label">æ•°æ®åº“</div>
            </div>
            <div class="stat-card">
                <div class="stat-val">172</div>
                <div class="stat-label">æ•°æ®æºæ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-val">12,768</div>
                <div class="stat-label">å­—æ®µæ€»æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-val">80</div>
                <div class="stat-label">å·¥ä½œç°¿</div>
            </div>
            <div class="stat-card">
                <div class="stat-val">1,594</div>
                <div class="stat-label">è§†å›¾</div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="dot" style="background: #228be6;"></div>æ­£å¸¸å…³è”</div>
            <div class="legend-item"><div class="dot" style="background: #be4bdb;"></div>åµŒå…¥å¼</div>
            <div class="legend-item"><div class="dot" style="background: #fa5252;"></div>å­¤ç«‹/æœªä½¿ç”¨</div>
            <div class="legend-item"><div class="dot" style="background: #fab005;"></div>æ–­é“¾ (Custom SQL)</div>
        </div>

        <div id="sankey-chart"></div>

        <div class="glossary">
            <h2>ğŸ“Š èµ„äº§å®šä¹‰è¯´æ˜</h2>
            <div class="glossary-grid">
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-healthy">æ­£å¸¸</span> å·²å‘å¸ƒæ•°æ®æº
                    </div>
                    <div class="glossary-desc">
                        å‘å¸ƒåœ¨ Tableau Server ä¸Šçš„ç‹¬ç«‹æ•°æ®æºï¼Œå·²å…³è”ç‰©ç†è¡¨å¹¶è¢«å·¥ä½œç°¿ä½¿ç”¨ã€‚
                    </div>
                </div>
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-embedded">åµŒå…¥</span> åµŒå…¥å¼æ•°æ®æº
                    </div>
                    <div class="glossary-desc">
                        å®šä¹‰åœ¨å·¥ä½œç°¿å†…éƒ¨çš„æ•°æ®æºã€‚å…³è”è¡¨æ¥è‡ª Metadata API è¡€ç¼˜ç©¿é€åŠŸèƒ½ã€‚
                    </div>
                </div>
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-orphan">å­¤ç«‹</span> å­¤ç«‹æ•°æ®æº
                    </div>
                    <div class="glossary-desc">
                        å·²å‘å¸ƒä¸”å…³è”äº†è¡¨ï¼Œä½†æ²¡æœ‰è¢«ä»»ä½•å·¥ä½œç°¿ä½¿ç”¨ï¼Œå±äºé—²ç½®èµ„æºã€‚
                    </div>
                </div>
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-broken">æ–­é“¾</span> Custom SQL æ•°æ®æº
                    </div>
                    <div class="glossary-desc">
                        åŒ…å«è‡ªå®šä¹‰ SQL çš„æ•°æ®æºï¼ŒMetadata API æ— æ³•è§£æå…¶ä¸Šæ¸¸ç‰©ç†è¡¨ (å·²çŸ¥å±€é™)ã€‚
                    </div>
                </div>
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-orphan">å­¤ç«‹</span> åƒµå°¸å­—æ®µ
                    </div>
                    <div class="glossary-desc">
                        æ—¢æ²¡æœ‰å‚ä¸è®¡ç®—ï¼Œä¹Ÿæ²¡æœ‰è¢«ä»»ä½•è§†å›¾å±•ç¤ºçš„å†—ä½™å­—æ®µï¼Œä¼šæ‹–æ…¢åŠ è½½é€Ÿåº¦ã€‚
                    </div>
                </div>
                <div class="glossary-card">
                    <div class="glossary-title">
                        <span class="badge badge-orphan">å­¤ç«‹</span> å­¤ç«‹è¡¨
                    </div>
                    <div class="glossary-desc">
                        å·²è¢«é‡‡é›†åˆ°å…ƒæ•°æ®ä¸­ï¼Œä½†æ²¡æœ‰è¢«ä»»ä½• Tableau æ•°æ®æºå¼•ç”¨çš„æ•°æ®åº“è¡¨ã€‚
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        var chartDom = document.getElementById('sankey-chart');
        var myChart = echarts.init(chartDom);
        var option;

        // Colors - æ›´ç°ä»£çš„é…è‰²
        const C_HEALTHY = '#3b82f6';  // è“è‰²
        const C_EMBEDDED = '#a855f7'; // ç´«è‰²
        const C_ORPHAN = '#f43f5e';   // çº¢è‰²
        const C_BROKEN = '#f59e0b';   // æŸ‘æ©™è‰²

        const data = [
            // Layer 0: æ•°æ®åº“
            { name: 'æ•°æ®åº“ (6)', itemStyle: { color: C_HEALTHY }, depth: 0 },
            
            // Layer 1: æ•°æ®è¡¨
            { name: 'éåµŒå…¥å¼è¡¨ (36)', itemStyle: { color: C_HEALTHY }, depth: 1 },
            { name: 'åµŒå…¥å¼è¡¨ (446)', itemStyle: { color: C_EMBEDDED }, depth: 1 },
            { name: 'å­¤ç«‹è¡¨ (309)', itemStyle: { color: C_ORPHAN }, depth: 1 },

            // Layer 2: å·²å‘å¸ƒæ•°æ®æº
            { name: 'æ­£å¸¸å‘å¸ƒæ•°æ®æº (21)', itemStyle: { color: C_HEALTHY }, depth: 2 },
            { name: 'å­¤ç«‹å‘å¸ƒæ•°æ®æº (30)', itemStyle: { color: C_ORPHAN }, depth: 2 },
            { name: 'CustomSQLæ•°æ®æº (6)', itemStyle: { color: C_BROKEN }, depth: 2 },

            // Layer 3: åµŒå…¥å¼æ•°æ®æº
            { name: 'åµŒå…¥å¼:å¼•ç”¨å·²å‘å¸ƒ (68)', itemStyle: { color: C_EMBEDDED }, depth: 3 },
            { name: 'åµŒå…¥å¼:ç›´è¿ç‰©ç†è¡¨ (47)', itemStyle: { color: C_EMBEDDED }, depth: 3 },

            // Layer 4: åŸç”Ÿå­—æ®µ
            { name: 'åŸç”Ÿå­—æ®µ (7,839)', itemStyle: { color: C_HEALTHY }, depth: 4 },
            { name: 'åƒµå°¸åŸç”Ÿå­—æ®µ (6,462)', itemStyle: { color: C_ORPHAN }, depth: 4 },
            
            // Layer 5: è®¡ç®—å­—æ®µ
            { name: 'è®¡ç®—å­—æ®µ (4,929)', itemStyle: { color: C_HEALTHY }, depth: 5 },
            { name: 'åƒµå°¸è®¡ç®—å­—æ®µ (3,089)', itemStyle: { color: C_ORPHAN }, depth: 5 },

            // Layer 6: å·¥ä½œç°¿
            { name: 'å·¥ä½œç°¿ (80)', itemStyle: { color: C_HEALTHY }, depth: 6 },

            // Layer 7: è§†å›¾
            { name: 'è§†å›¾ (1,594)', itemStyle: { color: C_HEALTHY }, depth: 7 }
        ];

        const links = [
            // Layer 0â†’1: æ•°æ®åº“ â†’ è¡¨
            { source: 'æ•°æ®åº“ (6)', target: 'éåµŒå…¥å¼è¡¨ (36)', value: 36 },
            { source: 'æ•°æ®åº“ (6)', target: 'åµŒå…¥å¼è¡¨ (446)', value: 446 },
            { source: 'æ•°æ®åº“ (6)', target: 'å­¤ç«‹è¡¨ (309)', value: 309 },

            // Layer 1â†’2: éåµŒå…¥å¼è¡¨ â†’ å·²å‘å¸ƒæ•°æ®æº
            { source: 'éåµŒå…¥å¼è¡¨ (36)', target: 'æ­£å¸¸å‘å¸ƒæ•°æ®æº (21)', value: 21 },
            { source: 'éåµŒå…¥å¼è¡¨ (36)', target: 'å­¤ç«‹å‘å¸ƒæ•°æ®æº (30)', value: 30 },
            
            // Layer 1â†’3: åµŒå…¥å¼è¡¨ â†’ åµŒå…¥å¼æ•°æ®æº(ç›´è¿å‹)
            { source: 'åµŒå…¥å¼è¡¨ (446)', target: 'åµŒå…¥å¼:ç›´è¿ç‰©ç†è¡¨ (47)', value: 47 },
            
            // Layer 2â†’3: å·²å‘å¸ƒæ•°æ®æº â†’ åµŒå…¥å¼æ•°æ®æº(å¼•ç”¨å‹) 
            { source: 'æ­£å¸¸å‘å¸ƒæ•°æ®æº (21)', target: 'åµŒå…¥å¼:å¼•ç”¨å·²å‘å¸ƒ (68)', value: 68 },

            // Layer 2â†’4: å·²å‘å¸ƒæ•°æ®æº â†’ åŸç”Ÿå­—æ®µ
            { source: 'æ­£å¸¸å‘å¸ƒæ•°æ®æº (21)', target: 'åŸç”Ÿå­—æ®µ (7,839)', value: 2613 },
            { source: 'æ­£å¸¸å‘å¸ƒæ•°æ®æº (21)', target: 'åƒµå°¸åŸç”Ÿå­—æ®µ (6,462)', value: 2154 },
            
            // Layer 3â†’4: åµŒå…¥å¼æ•°æ®æº â†’ åŸç”Ÿå­—æ®µ
            { source: 'åµŒå…¥å¼:å¼•ç”¨å·²å‘å¸ƒ (68)', target: 'åŸç”Ÿå­—æ®µ (7,839)', value: 2613 },
            { source: 'åµŒå…¥å¼:ç›´è¿ç‰©ç†è¡¨ (47)', target: 'åŸç”Ÿå­—æ®µ (7,839)', value: 2613 },
            { source: 'åµŒå…¥å¼:å¼•ç”¨å·²å‘å¸ƒ (68)', target: 'åƒµå°¸åŸç”Ÿå­—æ®µ (6,462)', value: 2154 },
            { source: 'åµŒå…¥å¼:ç›´è¿ç‰©ç†è¡¨ (47)', target: 'åƒµå°¸åŸç”Ÿå­—æ®µ (6,462)', value: 2154 },

            // Layer 4â†’5: åŸç”Ÿå­—æ®µ â†’ è®¡ç®—å­—æ®µ
            { source: 'åŸç”Ÿå­—æ®µ (7,839)', target: 'è®¡ç®—å­—æ®µ (4,929)', value: 4929 },
            { source: 'åŸç”Ÿå­—æ®µ (7,839)', target: 'åƒµå°¸è®¡ç®—å­—æ®µ (3,089)', value: 3089 },

            // Layer 4â†’6 & 5â†’6: å­—æ®µ â†’ å·¥ä½œç°¿
            { source: 'åŸç”Ÿå­—æ®µ (7,839)', target: 'å·¥ä½œç°¿ (80)', value: 3919 },
            { source: 'è®¡ç®—å­—æ®µ (4,929)', target: 'å·¥ä½œç°¿ (80)', value: 4929 },

            // Layer 6â†’7: å·¥ä½œç°¿ â†’ è§†å›¾
            { source: 'å·¥ä½œç°¿ (80)', target: 'è§†å›¾ (1,594)', value: 1594 }
        ];

        option = {
            tooltip: {
                trigger: 'item',
                triggerOn: 'mousemove',
                backgroundColor: 'rgba(255,255,255,0.95)',
                borderColor: '#e2e8f0',
                borderWidth: 1,
                padding: [12, 16],
                textStyle: {
                    color: '#334155',
                    fontSize: 13
                },
                extraCssText: 'box-shadow: 0 4px 20px rgba(0,0,0,0.15); border-radius: 8px;'
            },
            series: [
                {
                    type: 'sankey',
                    data: data,
                    links: links,
                    top: 60,
                    bottom: 60,
                    left: 80,
                    right: 180,
                    nodeWidth: 18,
                    nodeGap: 24,
                    emphasis: {
                        focus: 'adjacency',
                        itemStyle: {
                            shadowBlur: 20,
                            shadowColor: 'rgba(0,0,0,0.3)'
                        }
                    },
                    nodeAlign: 'left',
                    layoutIterations: 64,
                    lineStyle: {
                        color: 'gradient',
                        curveness: 0.5,
                        opacity: 0.4
                    },
                    label: {
                        position: 'right',
                        color: '#334155',
                        fontFamily: 'Inter, Arial, sans-serif',
                        fontSize: 12,
                        fontWeight: 500,
                        padding: [0, 0, 0, 8],
                        formatter: function(params) {
                            return params.name;
                        }
                    },
                    itemStyle: {
                        borderRadius: 4,
                        borderWidth: 0
                    }
                }
            ]
        };

        myChart.setOption(option);
        
        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>
</body>
</html>