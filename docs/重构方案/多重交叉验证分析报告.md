# 多重交叉验证分析报告 (Depth & Consistency)

> **版本**: v1.1  
> **更新日期**: 2025-12-24  
> **状态**: 已验证

## 一、 背景与挑战

传统的“血缘覆盖率”仅关注资产是否“关联上”。而在 Tableau 复杂场景中，存在严重的 **M:N (多对多)** 关系：
1. **一个计算字段关联多个物理表**: 多表 JOIN 或混合公式。
2. **一个字段关联多个工作簿**: 跨工作簿引用或同名物理列分布。
3. **推导关联 vs 直接关联**: 间接依赖链的完整性。

本报告通过多重交叉验证，确保重构后的血缘不仅“有”，而且“全”。

---

## 二、 关键验证结果

### 1. 计算字段多路径关联完整性 (M:N)
- **验证逻辑**: 统计单个计算字段关联的不同物理表数量。
- **结果**: 
    - 发现 10+ 个计算字段关联了 **6 个** 不同的物理表。
    - 样本: `HO班次`、`客公里` 等核心指标正确解析了其底层的多表依赖。
- **结论**: ✅ **通过**。推导血缘 (`field_full_lineage`) 完整保留了多路径复杂度，未发生关系截断。

### 2. 字段-工作簿多重引用的能力
- **验证逻辑**: 统计相同名称的物理列在不同工作簿实例中的分布。
- **结果**: 
    - 公共字段（如 `航段`、`航班号`）在超过 **40 个工作簿** 中独立存在并被追踪。
    - 极端样本: `:Measure Names` 共关联了 **54 个工作簿**。
- **结论**: ✅ **通过**。系统实现了对资产在不同业务上下文中分布的全量追踪。

### 3. 血缘覆盖深度 (推导增益)
- **统计口径对比**:
    - **直接关联 (Direct Linked)**: 5,838 (28.9%)
    - **推导关联 (Lineage Derived)**: **19,521 (96.5%)**
- **推导增益**: **+67.6%** (13,683 个字段通过 `Datasource -> Table` 链补全了血缘)。
- **结论**: ✅ **通过**。推导逻辑极大地解决了由于 Custom SQL 导致的字段级血缘断裂问题。

---

## 三、 51 项指标增强标准

为了避免后续统计误差，所有 51 项指标均增加 **[M:N Check]** 审计项：

| 校验类型                     | 说明         | 判定准则                                |
| :--------------------------- | :----------- | :-------------------------------------- |
| **关联性 (Linkage)**         | 是否有关联   | 覆盖率 > 0                              |
| **多重性 (Multiplicity)**    | 关联是否完整 | `Avg(Target_per_Source)` 等于或高于基准 |
| **推导一致性 (Consistency)** | 路径是否可达 | `LFL 覆盖数 >= 直接关联数`              |

---

## 四、 后续行动
1. **API 接口统一**: 强制前端所有详情页使用 `field_full_lineage` 作为血缘底表。 (已完成)
2. **孤立资产清理提示**: 对关联数为 0 的资产增加“孤立资产”标记。 (进行中)
