# 物理表 验证分析报告

**执行时间**: 2025-12-24 23:00
**验证状态**: ⚠️ 有差异

## 一、执行摘要

| 验证类别     | 通过项 | 异常项 | 通过率 |
| :----------- | :----: | :----: | :----: |
| 核心属性验证 |   3    |   0    |  100%  |
| 血缘质量检测 |   1    |   2    |  33%   |
| 关联元素验证 |   4    |   1    |  80%   |
| 前端元素对齐 |   4    |   0    |  100%  |
| 逻辑闭环验证 |   3    |   0    |  100%  |

## 二、问题详情

### 2.1 [质量问题]: 物理库表缺失底层列信息 (db_columns)

**位置**: `血缘质量检测.未匹配血缘检测[关联方向='物理表->数据列']`

**预期 vs 实际**:
| 指标         | 预期值 | 实际值 | 差异  |
| :----------- | :----: | :----: | :---: |
| 有列物理表数 |   36   |   17   |  -19  |

**影响范围**:
- 涉及 19 条物理表记录
- 导致详情页 "原始列" Tab 为空

**根因分析**:
1. **Custom SQL 表**: 19 个表中包含大量 `ods_`, `dim_`, `vm_` 前缀表，可能是通过 Custom SQL 定义的。Tableau Metadata API 对 `CustomSQLTable` 的 `columns` 返回逻辑与 `PhysicalTable` 不同。
2. **同步覆盖度**: 部分表在同步时虽然捕获了元数据，但 GraphQL 查询可能未带出其列信息。

**验证SQL**:
```sql
SELECT id, name FROM tables WHERE is_embedded = 0 AND NOT EXISTS (SELECT 1 FROM db_columns WHERE table_id = tables.id);
```

### 2.2 [质量问题]: 冗余资产检测 (无引用的物理表)

**位置**: `血缘质量检测.未匹配血缘检测[关联方向='物理表->数据源']`

**预期 vs 实际**:
| 指标           | 预期值 | 实际值 | 差异  |
| :------------- | :----: | :----: | :---: |
| 被引用物理表数 |   36   |   34   |  -2   |

**影响范围**: 2 个物理表未被任何数据源引用。

## 三、修复建议

### 3.1 [建议]: 增强 Custom SQL 字段捕获

**关联问题**: 问题 2.1

**修复方案**:
在 `backend/tableau_sync.py` 的 `fetch_tables` 查询中，针对 `databaseTables` 增加 `... on CustomSQLTable` 片段以捕获其列信息（虽然 Metadata API 对 CustomSQL 表的支持有限，通常需要通过字段反推）。

**预期效果**: 提升物理表列信息的完整度。

## 四、修复执行记录

| 修复ID |   状态   | 回归验证结果 |
| :----- | :------: | :----------- |
| 3.1    | ⏳ 待处理 | -            |
