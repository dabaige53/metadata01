# 发布式数据源 验证分析报告

**执行时间**: 2025-12-24 23:05
**验证状态**: ⚠️ 有差异

## 一、执行摘要

| 验证类别     | 通过项 | 异常项 | 通过率 |
| :----------- | :----: | :----: | :----: |
| 核心属性验证 |   2    |   1    |  66%   |
| 血缘质量检测 |   1    |   2    |  33%   |
| 关联元素验证 |   5    |   0    |  100%  |
| 前端元素对齐 |   1    |   3    |  25%   |
| 逻辑闭环验证 |   1    |   2    |  33%   |

## 二、问题详情

### 2.1 [指标差异]: 预计算统计项与血缘底层数据不匹配

**位置**: `前端元素对齐.列表卡片.字段:field_count/metric_count`

**预期 vs 实际**:
| 指标              | SQL血缘统计 (底层) | 预计算字段 (datasources表) | 差异  |
| :---------------- | :----------------: | :------------------------: | :---: |
| 字段总数 (Field)  |       15597        |           11966            | -3631 |
| 指标总数 (Metric) |        3631        |            2350            | -1281 |

**逻辑分析**:
计算发现 `15597 - 11966 = 3631`，且 `3631` 正好是指标总数。
这说明 `datasources.field_count` 目前只统计了**标准字段 (Regular Fields)**，而漏掉了**计算字段/指标 (Calculated Fields/Metrics)**。底层 `fields` 表包含两者，但同步时的预计算逻辑将它们分开了，或者 `field_count` 的定义不包含 `is_calculated=1` 的记录。

### 2.2 [资产质量]: 大量孤儿发布式数据源 (未被引用)

**位置**: `血缘质量检测.未匹配血缘检测[关联方向='发布源->工作簿']`

**状态**: 30 个发布式数据源未被任何工作簿引用（占比超过 52%）。

## 三、修复建议

### 3.1 [修复]: 修正数据源预计算统计逻辑

**关联问题**: 问题 2.1

**修复方案**:
更新 `backend/tableau_sync.py` 中更新 `datasources` 统计信息的逻辑。确保 `field_count` 包含所有字段，或明确区分 `field_count` 与 `metric_count` 并在前端正确求和展示。
当前前端 DatasourceCard 可能只显示了 `fieldCount` 而忽略了 `metricCount` 导致总数体感偏小。

## 四、修复执行记录

| 修复ID |   状态   | 回归验证结果 |
| :----- | :------: | :----------- |
| 3.1    | ⏳ 待处理 | -            |
