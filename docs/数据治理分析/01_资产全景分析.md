# 01 资产全景分析

> 对 Tableau 元数据资产进行全面盘点，建立资产认知基线。

---

## 分析目标

1. 清点所有数据资产类型和数量
2. 理解资产层级结构和分布
3. 识别资产归属（所有者、项目）
4. 建立资产分类标签体系

---

## 分析步骤

### Step 1: 资产清单统计

**分析SQL**:

```sql
-- 各实体数量统计
SELECT 'databases' as entity, COUNT(*) FROM databases
UNION ALL SELECT 'tables', COUNT(*) FROM tables
UNION ALL SELECT 'columns', COUNT(*) FROM db_columns
UNION ALL SELECT 'fields', COUNT(*) FROM fields
UNION ALL SELECT 'datasources', COUNT(*) FROM datasources
UNION ALL SELECT 'workbooks', COUNT(*) FROM workbooks
UNION ALL SELECT 'views', COUNT(*) FROM views;
```

**预期输出**:

| 资产类型 | 数量 | 说明 |
|---------|------|-----|
| 数据库 | 6 | 外部数据库连接 |
| 数据表 | 450 | 物理表/视图 |
| 数据列 | 4,720 | 原生数据库列 |
| 字段 | 8,314 | Tableau字段（含计算） |
| 数据源 | 53 | 已发布数据源 |
| 工作簿 | 79 | 可视化容器 |
| 视图 | 1,564 | 报表/仪表板 |

---

### Step 2: 层级结构分析

**数据流向**:

```
Database (6)
    └── Table (450)
         └── Column (4,720)
              │
Datasource (53) ◀─┘
    └── Field (8,314)
         └── Workbook (79)
              └── View (1,564)
```

**分析SQL**:

```sql
-- 数据库→表分布
SELECT d.name, COUNT(t.id) as table_count
FROM databases d
LEFT JOIN tables t ON d.id = t.database_id
GROUP BY d.id ORDER BY table_count DESC;

-- 工作簿→视图分布
SELECT w.name, COUNT(v.id) as view_count
FROM workbooks w
LEFT JOIN views v ON w.id = v.workbook_id
GROUP BY w.id ORDER BY view_count DESC LIMIT 10;
```

---

### Step 3: 项目分布分析

**分析SQL**:

```sql
-- 按项目统计数据源
SELECT project_name, COUNT(*) as ds_count
FROM datasources
WHERE project_name IS NOT NULL
GROUP BY project_name ORDER BY ds_count DESC;
```

**预期输出**:

| 项目 | 数据源数 | 占比 |
|-----|---------|------|
| 数据沙盒 | 39 | 73.6% |
| 数据处理流程 | 6 | 11.3% |
| Tableau 示例 | 6 | 11.3% |
| 默认值 | 2 | 3.8% |

---

### Step 4: 所有者分析

**分析SQL**:

```sql
-- 按所有者统计
SELECT owner, 
       COUNT(*) as asset_count,
       GROUP_CONCAT(name, ', ') as assets
FROM datasources
WHERE owner IS NOT NULL
GROUP BY owner ORDER BY asset_count DESC;
```

**预期输出**:

| 所有者 | 资产数 | 责任范围 |
|-------|-------|---------|
| huangguanru | 28 | 核心业务数据源 |
| admin | 25 | 系统/示例数据源 |

---

### Step 5: 数据类型分布

**分析SQL**:

```sql
-- 字段数据类型分布
SELECT data_type, COUNT(*) as cnt,
       ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM fields), 2) as pct
FROM fields
WHERE data_type IS NOT NULL
GROUP BY data_type ORDER BY cnt DESC;
```

**预期输出**:

| 数据类型 | 数量 | 占比 |
|---------|------|------|
| (未知) | 3,536 | 42.5% |
| REAL | 1,698 | 20.4% |
| INTEGER | 1,420 | 17.1% |
| STRING | 1,316 | 15.8% |
| BOOLEAN | 161 | 1.9% |
| SPATIAL | 96 | 1.2% |
| DATE/DATETIME | 87 | 1.0% |

---

### Step 6: 连接类型分析

**分析SQL**:

```sql
-- 数据库连接类型
SELECT connection_type, COUNT(*) as cnt
FROM databases
GROUP BY connection_type;

-- Schema分布
SELECT schema, COUNT(*) FROM tables
WHERE schema IS NOT NULL
GROUP BY schema ORDER BY COUNT(*) DESC;
```

---

## 输出物

1. **资产清单表** - 各类资产的完整列表
2. **层级结构图** - 资产间的关系可视化
3. **分布统计表** - 按项目/所有者/类型的统计
4. **资产标签** - 分类标签体系建议

---

## 治理建议

| 发现 | 建议 |
|-----|-----|
| 42.5%字段无数据类型 | 同步时补充类型元数据 |
| 2个所有者管理53个数据源 | 考虑分配备份责任人 |
| 73.6%资产在数据沙盒项目 | 评估项目划分合理性 |
