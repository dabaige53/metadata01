# 04 æ—¶é—´è¶‹åŠ¿åˆ†æ

> åˆ†æèµ„äº§åˆ›å»º/æ›´æ–°çš„æ—¶é—´è§„å¾‹ï¼Œè¯†åˆ«ç”Ÿå‘½å‘¨æœŸé˜¶æ®µã€‚

---

## åˆ†æç›®æ ‡

1. æŒæ¡èµ„äº§å¢é•¿è¶‹åŠ¿
2. è¯†åˆ«æ´»è·ƒæœŸä¸è¡°é€€æœŸ
3. å‘ç°é™ˆæ—§/è¿‡æœŸèµ„äº§
4. è¯„ä¼°æ•°æ®åˆ·æ–°æ—¶æ•ˆæ€§

---

## åˆ†ææ­¥éª¤

### Step 1: èµ„äº§åˆ›å»ºè¶‹åŠ¿

**åˆ†æSQL**:

```sql
-- æ•°æ®æºæŒ‰æœˆåˆ›å»ºæ•°é‡
SELECT strftime('%Y-%m', created_at) as month,
       COUNT(*) as created_count
FROM datasources
WHERE created_at IS NOT NULL
GROUP BY month ORDER BY month;

-- å·¥ä½œç°¿æŒ‰æœˆåˆ›å»ºæ•°é‡
SELECT strftime('%Y-%m', created_at) as month,
       COUNT(*) as created_count
FROM workbooks
WHERE created_at IS NOT NULL
GROUP BY month ORDER BY month;
```

**åˆ›å»ºè¶‹åŠ¿å›¾ï¼ˆæ•°æ®æºï¼‰**:

```
2024-08 â–ˆâ–ˆ 2
2024-11 â–ˆâ–ˆâ–ˆ 3
2025-03 â–ˆâ–ˆ 2
2025-04 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10   â† å³°å€¼
2025-05 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 6
2025-08 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 8
2025-09 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 7
2025-10 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 8
2025-11 â–ˆâ–ˆâ–ˆâ–ˆ 4
```

**åˆ›å»ºè¶‹åŠ¿å›¾ï¼ˆå·¥ä½œç°¿ï¼‰**:

```
2024-08 â–ˆâ–ˆâ–ˆ 3
2025-01 â–ˆâ–ˆâ–ˆ 3
2025-06 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10
2025-07 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12
2025-09 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 7
2025-10 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 8
2025-11 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 13  â† å³°å€¼
2025-12 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 5
```

---

### Step 2: èµ„äº§å¹´é¾„åˆ†å¸ƒ

**åˆ†æSQL**:

```sql
-- æ•°æ®æºå¹´é¾„åˆ†å¸ƒ
SELECT 
    CASE 
        WHEN julianday('now') - julianday(created_at) < 30 THEN 'æ–°å»º(<1æœˆ)'
        WHEN julianday('now') - julianday(created_at) < 90 THEN 'è¿‘æœŸ(1-3æœˆ)'
        WHEN julianday('now') - julianday(created_at) < 180 THEN 'ä¸­æœŸ(3-6æœˆ)'
        WHEN julianday('now') - julianday(created_at) < 365 THEN 'è¾ƒä¹…(6-12æœˆ)'
        ELSE 'è€æ—§(>1å¹´)'
    END as age_tier,
    COUNT(*) as count
FROM datasources
WHERE created_at IS NOT NULL
GROUP BY age_tier;
```

---

### Step 3: æœ€è¿‘æ›´æ–°åˆ†æ

**åˆ†æSQL**:

```sql
-- æœ€è¿‘æ›´æ–°çš„æ•°æ®æº Top 10
SELECT name, updated_at, owner
FROM datasources
WHERE updated_at IS NOT NULL
ORDER BY updated_at DESC LIMIT 10;

-- é•¿æœŸæœªæ›´æ–°çš„æ•°æ®æºï¼ˆè¶…è¿‡90å¤©ï¼‰
SELECT name, updated_at, 
       julianday('now') - julianday(updated_at) as days_since_update
FROM datasources
WHERE updated_at IS NOT NULL
  AND julianday('now') - julianday(updated_at) > 90
ORDER BY updated_at;
```

---

### Step 4: æŠ½å–åˆ·æ–°åˆ†æ

**åˆ†æSQL**:

```sql
-- æŠ½å–æ•°æ®æºåˆ·æ–°çŠ¶æ€
SELECT name,
       has_extract,
       extract_last_refresh_time,
       extract_last_incremental_update_time,
       CASE 
           WHEN extract_last_refresh_time IS NULL THEN 'ä»æœªåˆ·æ–°'
           WHEN julianday('now') - julianday(extract_last_refresh_time) > 30 THEN 'è¿‡æœŸ(>30å¤©)'
           WHEN julianday('now') - julianday(extract_last_refresh_time) > 7 THEN 'è¾ƒæ—§(7-30å¤©)'
           ELSE 'æ­£å¸¸(<7å¤©)'
       END as refresh_status
FROM datasources
WHERE has_extract = 1;

-- åˆ·æ–°çŠ¶æ€ç»Ÿè®¡
SELECT refresh_status, COUNT(*) FROM (
    SELECT CASE 
        WHEN extract_last_refresh_time IS NULL THEN 'ä»æœªåˆ·æ–°'
        WHEN julianday('now') - julianday(extract_last_refresh_time) > 30 THEN 'è¿‡æœŸ'
        WHEN julianday('now') - julianday(extract_last_refresh_time) > 7 THEN 'è¾ƒæ—§'
        ELSE 'æ­£å¸¸'
    END as refresh_status
    FROM datasources WHERE has_extract = 1
) GROUP BY refresh_status;
```

**å½“å‰æŠ½å–æ•°æ®æº**: 31ä¸ª

---

### Step 5: ç”Ÿå‘½å‘¨æœŸé˜¶æ®µè¯†åˆ«

| é˜¶æ®µ | åˆ¤æ–­æ ‡å‡† | æ²»ç†ç­–ç•¥ |
|-----|---------|---------|
| ğŸ†• **æ–°å»ºæœŸ** | åˆ›å»º<30å¤© | å®Œå–„æ–‡æ¡£ã€å»ºç«‹è¡€ç¼˜ |
| âœ… **æ´»è·ƒæœŸ** | è¿‘30å¤©æœ‰æ›´æ–°æˆ–è®¿é—® | å¸¸è§„ç»´æŠ¤ |
| âš ï¸ **è¡°é€€æœŸ** | 60-180å¤©æ— æ´»åŠ¨ | è¯„ä¼°ä»·å€¼ã€è­¦å‘Šé€šçŸ¥ |
| â„ï¸ **ä¼‘çœ æœŸ** | >180å¤©æ— æ´»åŠ¨ | å½’æ¡£æˆ–æ¸…ç†å€™é€‰ |

**åˆ†æSQL**:

```sql
-- ç”Ÿå‘½å‘¨æœŸé˜¶æ®µåˆ†å¸ƒ
SELECT 
    CASE 
        WHEN julianday('now') - julianday(COALESCE(updated_at, created_at)) < 30 THEN 'æ–°å»ºæœŸ'
        WHEN julianday('now') - julianday(COALESCE(updated_at, created_at)) < 60 THEN 'æ´»è·ƒæœŸ'
        WHEN julianday('now') - julianday(COALESCE(updated_at, created_at)) < 180 THEN 'è¡°é€€æœŸ'
        ELSE 'ä¼‘çœ æœŸ'
    END as lifecycle,
    COUNT(*) as count
FROM datasources
GROUP BY lifecycle;
```

---

### Step 6: å­£åº¦å¯¹æ¯”åˆ†æ

**åˆ†æSQL**:

```sql
-- æŒ‰å­£åº¦ç»Ÿè®¡å„ç±»èµ„äº§åˆ›å»ºé‡
SELECT 
    strftime('%Y', created_at) || '-Q' || ((CAST(strftime('%m', created_at) AS INTEGER) - 1) / 3 + 1) as quarter,
    'datasources' as entity,
    COUNT(*) as count
FROM datasources WHERE created_at IS NOT NULL
GROUP BY quarter
UNION ALL
SELECT 
    strftime('%Y', created_at) || '-Q' || ((CAST(strftime('%m', created_at) AS INTEGER) - 1) / 3 + 1),
    'workbooks',
    COUNT(*)
FROM workbooks WHERE created_at IS NOT NULL
GROUP BY quarter
ORDER BY quarter, entity;
```

---

### Step 7: åŒæ­¥æ—¥å¿—åˆ†æ

**åˆ†æSQL**:

```sql
-- æœ€è¿‘åŒæ­¥è®°å½•
SELECT sync_type, status, started_at, completed_at, records_synced
FROM sync_logs
ORDER BY started_at DESC LIMIT 10;

-- åŒæ­¥æˆåŠŸç‡
SELECT status, COUNT(*) as count,
       ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM sync_logs), 2) as pct
FROM sync_logs
GROUP BY status;
```

---

## è¾“å‡ºç‰©

1. **åˆ›å»ºè¶‹åŠ¿å›¾è¡¨** - å„ç±»èµ„äº§æŒ‰æ—¶é—´çš„å¢é•¿æ›²çº¿
2. **å¹´é¾„åˆ†å¸ƒæŠ¥å‘Š** - èµ„äº§æ–°æ—§ç¨‹åº¦åˆ†æ
3. **åˆ·æ–°çŠ¶æ€æŠ¥å‘Š** - æŠ½å–æ•°æ®æºæ—¶æ•ˆæ€§è¯„ä¼°
4. **ç”Ÿå‘½å‘¨æœŸæŠ¥å‘Š** - å„é˜¶æ®µèµ„äº§æ•°é‡åŠæ¸…å•

---

## æ²»ç†å»ºè®®

| å‘ç° | å»ºè®® |
|-----|-----|
| 2025å¹´Q2-Q4åˆ›å»ºé«˜å³° | ç¡®ä¿æ–°èµ„äº§æœ‰å®Œæ•´æ–‡æ¡£ |
| éƒ¨åˆ†æŠ½å–æ•°æ®æºè¿‡æœŸ | æ£€æŸ¥åˆ·æ–°è°ƒåº¦é…ç½® |
| å­˜åœ¨é•¿æœŸæœªæ›´æ–°èµ„äº§ | å»ºç«‹å®šæœŸæ´»è·ƒåº¦æ£€æŸ¥æœºåˆ¶ |
| åŒæ­¥æ—¥å¿—å¯è¿½æº¯ | ä¿æŒå®šæœŸåŒæ­¥ï¼Œç›‘æ§åŒæ­¥çŠ¶æ€ |
