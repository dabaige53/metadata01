# 产品治理场景优化方案

> 基于元数据分析结果，梳理当前产品对治理场景的支持情况，规划Tab扩展方案

---

## 一、现状分析

### 1.1 当前Tab实现情况

| 模块 | 已实现Tab | 分析组件 | 治理场景覆盖 |
|-----|----------|---------|------------|
| 指标库 `/metrics` | 指标列表 + 重复指标分析 | `DuplicateMetricsAnalysis` | ✅ 部分覆盖 |
| 字段字典 `/fields` | 字段列表 + 无描述字段 | `NoDescriptionFieldsAnalysis` | ✅ 部分覆盖 |
| 数据表 `/tables` | 表列表 + 未使用表 | `UnusedTablesAnalysis` | ✅ 部分覆盖 |
| 数据源 `/datasources` | 数据源列表 + 未认证分析 | `UncertifiedDatasourcesAnalysis` | ✅ 部分覆盖 |
| 工作簿 `/workbooks` | 工作簿列表 + 空工作簿 | `EmptyWorkbooksAnalysis` | ✅ 部分覆盖 |
| 视图 `/views` | 视图列表 + 孤立视图 | `OrphanedViewsAnalysis` | ✅ 部分覆盖 |

### 1.2 现有问题

1. **每个模块仅2个Tab**：目前仅支持 `list` + `analysis` 两种模式
2. **治理场景不完整**：数据分析发现多个重要场景未覆盖
3. **Tab类型受限**：代码中定义为 `'list' | 'analysis'` 联合类型

---

## 二、数据分析发现的治理场景

### 2.1 治理问题与场景映射

| 发现的问题 | 数量 | 优先级 | 对应模块 | 建议Tab |
|-----------|------|-------|---------|--------|
| 字段无描述 | 8,311 (99.96%) | P0 | 字段字典 | ✅ 已有"无描述字段" |
| 孤立表 | 388 (86.2%) | P0 | 数据表 | ✅ 已有"未使用表" |
| 孤立字段 | 6,341 (76.3%) | P1 | 字段字典 | ⚠️ 需新增"孤立字段" |
| 未认证数据源 | 53 (100%) | P1 | 数据源 | ✅ 已有"未认证分析" |
| 孤立数据源 | 27 (50.9%) | P1 | 数据源 | ⚠️ 需新增"孤立数据源" |
| 重复公式 | 958组 | P2 | 指标库 | ✅ 已有"重复指标" |
| 零访问视图 | 1,077 (68.9%) | P2 | 视图 | ⚠️ 需更名"零访问视图" |
| 高复杂指标 | 314 (>500字符) | P2 | 指标库 | ⚠️ 需新增"高复杂度指标" |
| 核心资产 | Top 20 | - | 全局 | ⚠️ 需新增"核心资产" |
| 热门字段 | Top 20 被引用 | - | 字段字典 | ⚠️ 需新增"热门字段" |

---

## 三、产品优化方案

### 3.1 Tab架构升级

**当前架构**:

```typescript
type TabType = 'list' | 'analysis';
```

**建议升级为**:

```typescript
// 通用Tab类型
type CommonTabType = 'list' | string;  // 支持动态扩展

// 各模块特定Tab
type FieldsTab = 'list' | 'noDescription' | 'orphan' | 'hot';
type MetricsTab = 'list' | 'duplicate' | 'complex';
type TablesTab = 'list' | 'unused' | 'wide';
type DatasourcesTab = 'list' | 'uncertified' | 'orphan';
type ViewsTab = 'list' | 'zeroAccess' | 'hot';
type WorkbooksTab = 'list' | 'empty' | 'singleSource';
```

---

### 3.2 各模块Tab扩展方案

#### 📁 字段字典 `/fields`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 字段列表 | 全部字段 | 8,314 | ✅ 已有 |
| `noDescription` | 无描述字段 | 缺少描述的字段 | 8,311 | ✅ 已有 |
| **`orphan`** | **孤立字段** | **未被视图使用** | **6,341** | ⚠️ **待新增** |
| **`hot`** | **热门字段** | **被引用>20次** | **1,456** | ⚠️ **待新增** |

**优先级**: P1 - 孤立字段是核心治理场景

---

#### 📊 指标库 `/metrics`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 指标列表 | 全部计算字段 | 4,778 | ✅ 已有 |
| `duplicate` | 重复指标 | 相同公式不同命名 | 958组 | ✅ 已有 |
| **`complex`** | **高复杂度** | **公式>500字符** | **314** | ⚠️ **待新增** |
| **`unused`** | **未使用指标** | **未被引用** | **3,020** | ⚠️ **待新增** |

**优先级**: P2 - 复杂度分析可帮助简化指标

---

#### 📋 数据表 `/tables`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 表列表 | 全部数据表 | 450 | ✅ 已有 |
| `unused` | 未使用表 | 未被数据源引用 | 388 | ✅ 已有 (同孤立表) |
| **`wide`** | **宽表分析** | **列数>100** | **待统计** | ⚠️ **待新增** |
| **`core`** | **核心表** | **影响视图>100** | **~10** | ⚠️ **待新增** |

**优先级**: P2 - 核心表识别有助于变更管理

---

#### 🔌 数据源 `/datasources`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 数据源列表 | 全部数据源 | 53 | ✅ 已有 |
| `uncertified` | 未认证 | 未通过认证 | 53 | ✅ 已有 |
| **`orphan`** | **孤立数据源** | **未被工作簿使用** | **27** | ⚠️ **待新增** |
| **`stale`** | **过期抽取** | **刷新>30天** | **3** | ⚠️ **可选** |

**优先级**: P1 - 孤立数据源占50%，需清理

---

#### 📖 工作簿 `/workbooks`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 工作簿列表 | 全部工作簿 | 79 | ✅ 已有 |
| `empty` | 空工作簿 | 无视图 | - | ✅ 已有 |
| **`singleSource`** | **单源依赖** | **仅依赖1个数据源** | **待统计** | ⚠️ **待新增** |
| **`hot`** | **热门工作簿** | **访问量Top 10** | **10** | ⚠️ **待新增** |

**优先级**: P3 - 工作簿问题相对较少

---

#### 👁️ 视图 `/views`

| Tab | 名称 | 描述 | 数量 | 状态 |
|----|-----|------|-----|------|
| `list` | 视图列表 | 全部视图 | 1,564 | ✅ 已有 |
| `orphan` | 孤立视图 | ❓含义待确认 | - | ✅ 已有 |
| **`zeroAccess`** | **零访问视图** | **从未访问** | **1,077** | ⚠️ **改名/新增** |
| **`hot`** | **热门视图** | **访问>100次** | **52** | ⚠️ **待新增** |

**优先级**: P2 - 68.9%零访问视图需关注

---

## 四、实施计划

### Phase 1: 核心场景扩展 (P0/P1)

| 序号 | 模块 | 新增Tab | 优先级 | 工作量 |
|-----|-----|--------|-------|-------|
| 1 | 字段字典 | 孤立字段 | P1 | 1天 |
| 2 | 数据源 | 孤立数据源 | P1 | 1天 |
| 3 | 视图 | 零访问视图 (改名) | P2 | 0.5天 |

### Phase 2: 增强分析场景

| 序号 | 模块 | 新增Tab | 优先级 | 工作量 |
|-----|-----|--------|-------|-------|
| 4 | 指标库 | 高复杂度指标 | P2 | 1天 |
| 5 | 指标库 | 未使用指标 | P2 | 1天 |
| 6 | 字段字典 | 热门字段 | P2 | 0.5天 |
| 7 | 视图 | 热门视图 | P2 | 0.5天 |

### Phase 3: 扩展场景

| 序号 | 模块 | 新增Tab | 优先级 | 工作量 |
|-----|-----|--------|-------|-------|
| 8 | 数据表 | 核心表 | P3 | 1天 |
| 9 | 工作簿 | 热门工作簿 | P3 | 0.5天 |

---

## 五、技术实施要点

### 5.1 Tab类型扩展模式

```typescript
// 字段字典示例
type FieldsActiveTab = 'list' | 'noDescription' | 'orphan' | 'hot';

const [activeTab, setActiveTab] = useState<FieldsActiveTab>('list');

// Tab渲染
const tabs = [
  { key: 'list', label: '字段列表', count: totalFields },
  { key: 'noDescription', label: '无描述字段', count: 8311 },
  { key: 'orphan', label: '孤立字段', count: 6341 },
  { key: 'hot', label: '热门字段', count: 1456 },
];
```

### 5.2 分析组件命名规范

- `{Module}{Problem}Analysis.tsx`
- 示例: `FieldsOrphanAnalysis.tsx`, `MetricsComplexAnalysis.tsx`

### 5.3 API支持

需确保后端API支持各分析场景的筛选条件：

| Tab | 所需API参数 |
|-----|-----------|
| 孤立字段 | `/api/fields?orphan=true` |
| 孤立数据源 | `/api/datasources?orphan=true` |
| 高复杂指标 | `/api/metrics?complexity_min=500` |
| 零访问视图 | `/api/views?access=0` |

---

## 六、优先级总结

```
┌─────────────────────────────────────────────────────┐
│                  治理场景优先级                       │
├─────────────────────────────────────────────────────┤
│                                                      │
│  P1 (必须): 孤立字段(6341) + 孤立数据源(27)          │
│            ↓                                         │
│  P2 (建议): 零访问视图(1077) + 高复杂指标(314)       │
│            ↓                                         │
│  P3 (可选): 核心表 + 热门资产排行                    │
│                                                      │
└─────────────────────────────────────────────────────┘
```

---

## 七、预期收益

| 新增场景 | 覆盖问题数 | 治理价值 |
|---------|----------|---------|
| 孤立字段 | 6,341 | 识别无用字段，清理候选 |
| 孤立数据源 | 27 | 识别无用数据源，节约资源 |
| 零访问视图 | 1,077 | 识别僵尸报表，优化维护 |
| 高复杂指标 | 314 | 风险评估，简化建议 |
| 热门资产 | ~100 | 核心资产识别，优先保障 |

**总计新增覆盖**: 7,859 个治理问题点
