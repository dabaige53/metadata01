{
    "标准字段(去重后)": {
        "任务描述": "验证去重后标准字段表的核心指标及关联完整性",
        "显示名称": "标准字段(去重后)",
        "模块定义": {
            "数据库表": "unique_regular_fields",
            "说明": "去重后的标准字段表，按穿透继承策略去重（upstream_column_id优先，回退到(table_id,name)或(datasource_id,name)）",
            "主键": "id",
            "实例表": "regular_fields",
            "去重策略": "V5穿透继承"
        },
        "核心属性验证": {
            "任务描述": "验证标准字段的基础属性统计",
            "标准字段总数": {
                "任务描述": "统计去重后的标准字段数",
                "API路径": "/api/stats",
                "API取值键": "uniqueFields",
                "API实际结果": "",
                "SQL查询": "SELECT COUNT(*) FROM unique_regular_fields",
                "SQL实际结果": ""
            },
            "实例字段总数": {
                "任务描述": "统计对应的实例字段数",
                "SQL查询": "SELECT COUNT(*) FROM regular_fields",
                "SQL实际结果": ""
            },
            "去重率": {
                "任务描述": "计算去重效果 (1 - 标准数/实例数)",
                "SQL查询": "SELECT ROUND(1.0 - CAST((SELECT COUNT(*) FROM unique_regular_fields) AS REAL) / (SELECT COUNT(*) FROM regular_fields), 4)",
                "期望值": "约0.56",
                "SQL实际结果": ""
            },
            "角色分布 (枚举)": {
                "任务描述": "验证标准字段按角色的分布",
                "SQL查询": "SELECT role || ':' || COUNT(*) FROM unique_regular_fields GROUP BY role",
                "SQL实际分布": ""
            },
            "平均实例数": {
                "任务描述": "每个标准字段平均对应多少实例",
                "SQL查询": "SELECT ROUND(CAST((SELECT COUNT(*) FROM regular_fields) AS REAL) / (SELECT COUNT(*) FROM unique_regular_fields), 2)",
                "SQL实际结果": ""
            }
        },
        "血缘质量检测": {
            "任务描述": "检测标准字段的关联完整性和去重质量",
            "关键字段空值检测": [
                {
                    "字段名": "name",
                    "任务描述": "标准字段名称不能为空",
                    "SQL查询": "SELECT COUNT(*) FROM unique_regular_fields WHERE name IS NULL OR name = ''",
                    "期望值": "0",
                    "SQL实际结果": ""
                },
                {
                    "字段名": "dedup_key",
                    "任务描述": "去重键不能为空",
                    "SQL查询": "SELECT COUNT(*) FROM unique_regular_fields WHERE dedup_key IS NULL OR dedup_key = ''",
                    "期望值": "0",
                    "SQL实际结果": ""
                }
            ],
            "残留重复检测": {
                "任务描述": "检测是否存在遗漏的重复（同数据源同名但不同unique_id）",
                "SQL查询": "SELECT COUNT(*) FROM (SELECT datasource_id, name FROM regular_fields GROUP BY datasource_id, name HAVING COUNT(DISTINCT unique_id) > 1)",
                "期望值": "<=4 (边界情况)",
                "SQL实际结果": ""
            },
            "孤儿标准字段检测": {
                "任务描述": "检测没有任何实例关联的标准字段",
                "SQL查询": "SELECT COUNT(*) FROM unique_regular_fields urf WHERE NOT EXISTS (SELECT 1 FROM regular_fields rf WHERE rf.unique_id = urf.id)",
                "期望值": "0",
                "SQL实际结果": ""
            }
        },
        "关联元素": [
            {
                "目标模块": "实例字段",
                "任务描述": "验证标准字段与实例字段的 1:N 关系",
                "关联方式": "unique_regular_fields.id < regular_fields.unique_id",
                "关联验证": {
                    "正向SQL (标准>实例)": "SELECT COUNT(DISTINCT urf.id) || ':' || COUNT(DISTINCT rf.id) FROM unique_regular_fields urf JOIN regular_fields rf ON urf.id = rf.unique_id",
                    "正向SQL结果": "",
                    "反向SQL (实例>标准)": "SELECT COUNT(DISTINCT rf.id) || ':' || COUNT(DISTINCT rf.unique_id) FROM regular_fields rf WHERE rf.unique_id IS NOT NULL",
                    "反向SQL结果": ""
                }
            },
            {
                "目标模块": "实例分布分析",
                "任务描述": "分析每个标准字段的实例分布",
                "关联验证": {
                    "典型实例数分布SQL": "SELECT CASE WHEN cnt = 1 THEN '1个实例' WHEN cnt <= 3 THEN '2-3个实例' WHEN cnt <= 10 THEN '4-10个实例' ELSE '>10个实例' END || ':' || COUNT(*) FROM (SELECT unique_id, COUNT(*) as cnt FROM regular_fields GROUP BY unique_id) GROUP BY 1",
                    "SQL实际分布": ""
                }
            }
        ],
        "前端元素对齐": {
            "任务描述": "标准字段目前不直接展示在前端，仅通过 uniqueId 字段关联实例",
            "关联说明": "前端 /api/fields 返回的 uniqueId 字段指向 unique_regular_fields.id"
        },
        "逻辑闭环验证": {
            "任务描述": "验证标准字段与实例的完整映射",
            "比对项列表": [
                {
                    "比对名称": "实例全覆盖闭环",
                    "前端数据源": "核心属性验证.实例字段总数.SQL实际结果",
                    "血缘数据源": "关联元素[目标模块='实例字段'].关联验证.正向SQL结果(提取实例数)",
                    "比对逻辑": "数值相等",
                    "差异容忍度": 0
                },
                {
                    "比对名称": "标准字段无孤儿闭环",
                    "描述": "每个标准字段至少有1个实例",
                    "前端数据源": "核心属性验证.标准字段总数.SQL实际结果",
                    "血缘数据源": "关联元素[目标模块='实例字段'].关联验证.正向SQL结果(提取标准数)",
                    "比对逻辑": "数值相等",
                    "差异容忍度": 0
                }
            ]
        }
    }
}