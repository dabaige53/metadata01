# Tableau 元数据治理平台 - 功能模块说明

> 本文档梳理平台中的核心功能模块，明确各模块的定义、数据来源及相互关系。

---

## 模块概览

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            数据层次结构                                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   【数据库层】          【数据加工层】          【展示层】                      │
│                                                                             │
│   ┌──────────┐         ┌──────────┐         ┌──────────┐                   │
│   │ Database │ ──────▶ │Datasource│ ──────▶ │ Workbook │                   │
│   │  数据库   │         │  数据源   │         │  工作簿   │                   │
│   └────┬─────┘         └────┬─────┘         └────┬─────┘                   │
│        │                    │                    │                          │
│        ▼                    ▼                    ▼                          │
│   ┌──────────┐         ┌──────────┐         ┌──────────┐                   │
│   │  Table   │         │  Field   │         │   View   │                   │
│   │  数据表   │         │   字段   │         │ 视图/仪表板│                   │
│   └────┬─────┘         └────┬─────┘         └──────────┘                   │
│        │                    │                                               │
│        ▼                    ▼                                               │
│   ┌──────────┐         ┌──────────┐                                        │
│   │  Column  │         │  Metric  │                                        │
│   │  数据列   │         │   指标   │                                        │
│   └──────────┘         └──────────┘                                        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 模块详细说明

### 1. Database（数据库）

| 项目 | 说明 |
|------|------|
| **定义** | 外部数据库连接，Tableau 数据的最上游来源 |
| **来源** | Tableau Metadata API → databases |
| **关键属性** | `name`, `connection_type`, `host_name`, `port`, `is_certified` |
| **下游关联** | Table（数据表） |

**连接类型示例**：

- `snowflake` - Snowflake
- `sqlserver` - SQL Server  
- `oracle` - Oracle
- `excel-direct` - Excel 文件

---

### 2. Table（数据表）

| 项目 | 说明 |
|------|------|
| **定义** | 数据库中的物理表或视图 |
| **来源** | Tableau Metadata API → databaseTables |
| **关键属性** | `name`, `schema`, `full_name`, `is_embedded`, `is_certified` |
| **上游关联** | Database（数据库） |
| **下游关联** | Column（数据列）、Datasource（数据源） |

**特殊标记**：

- `is_embedded = true` → 嵌入式表（内嵌在数据源/工作簿中）
- `is_embedded = false` → 独立发布表

---

### 3. Column（数据列）

| 项目 | 说明 |
|------|------|
| **定义** | 数据表中的**原生数据库列**，保留数据库的原始类型 |
| **来源** | Tableau Metadata API → columns |
| **关键属性** | `name`, `remote_type`, `is_nullable`, `description` |
| **上游关联** | Table（数据表） |
| **下游关联** | Field（字段） - 作为字段的 upstream 来源 |

**与 Field 的区别**：

| Column（数据列） | Field（字段） |
|------------------|---------------|
| 数据库原生列 | Tableau 中定义的字段 |
| 类型为 `VARCHAR2(100)` 等 | 类型为 `string`, `integer` 等 |
| 不可在 Tableau 中修改 | 可重命名、添加计算 |
| 无角色概念 | 有 **度量/维度** 角色 |

---

### 4. Datasource（数据源）

| 项目 | 说明 |
|------|------|
| **定义** | Tableau 已发布的数据源，封装了数据连接和字段定义 |
| **来源** | Tableau Metadata API → publishedDatasources |
| **关键属性** | `name`, `owner`, `project_name`, `has_extract`, `is_certified` |
| **上游关联** | Table（数据表） |
| **下游关联** | Field（字段）、Workbook（工作簿） |

**数据源类型**：

- `has_extract = true` → **Extract 模式**（数据提取，定期刷新）
- `has_extract = false` → **Live 模式**（实时连接）

---

### 5. Field（字段）⭐

| 项目 | 说明 |
|------|------|
| **定义** | 数据源或工作簿中的字段，是 Tableau 分析的基础单元 |
| **来源** | Tableau Metadata API → fields |
| **关键属性** | `name`, `data_type`, `role`, `is_calculated`, `formula` |
| **上游关联** | Table（通过 upstreamColumns）、Datasource |
| **下游关联** | Metric（指标）、View（视图） |

#### 💡 字段角色（role）

| 角色 | 标识 | 说明 | 图标 |
|------|------|------|------|
| **维度 (Dimension)** | `role = 'dimension'` | 分类字段，用于分组 | 🔵 蓝色点 |
| **度量 (Measure)** | `role = 'measure'` | 数值字段，用于计算 | 🟢 绿色点 |

#### 字段类型

| 类型 | 说明 | 示例 |
|------|------|------|
| **普通字段** | 直接映射数据库列 | 订单日期、客户名称 |
| **计算字段** | 通过公式创建 (`is_calculated = true`) | 利润率、年同比 |

#### 字段名称层次

```
原始列名 (upstreamColumns)  →  完全限定名 (fullyQualifiedName)  →  显示名 (name/caption)
       ORDER_AMOUNT              [Orders].[ORDER_AMOUNT]              订单金额
```

---

### 6. Metric（指标）⭐

| 项目 | 说明 |
|------|------|
| **定义** | 标准化的业务指标，用于统一指标口径和发现重复定义 |
| **来源** | 从 **计算字段 (is_calculated=true)** 中提取并分析 |
| **关键属性** | `name`, `formula`, `formula_hash`, `metric_type`, `complexity_score` |
| **上游关联** | Field（计算字段） |

#### ⚠️ 字段 vs 指标的区别

| 字段 (Field) | 指标 (Metric) |
|--------------|---------------|
| Tableau 原生概念 | 治理平台抽象概念 |
| 包含维度和度量 | 专注于**业务指标** |
| 来自 Metadata API | 从计算字段中提取分析 |
| 描述数据结构 | 描述业务逻辑 |

#### 指标类型

| 类型 | 说明 |
|------|------|
| `KPI` | 关键绩效指标 |
| `Calculated` | 一般计算指标 |
| `Ratio` | 比率类指标 |

#### 指标治理功能

1. **重复检测**：通过 `formula_hash` 发现相同公式的不同命名指标
2. **复杂度分析**：评估公式复杂程度
3. **依赖分析**：追踪指标依赖的基础字段

---

### 7. Workbook（工作簿）

| 项目 | 说明 |
|------|------|
| **定义** | Tableau 可视化内容的容器 |
| **来源** | Tableau Metadata API → workbooks |
| **关键属性** | `name`, `owner`, `project_name`, `description` |
| **上游关联** | Datasource（数据源） |
| **下游关联** | View（视图/仪表板） |

---

### 8. View（视图/仪表板）

| 项目 | 说明 |
|------|------|
| **定义** | 工作簿中的单个可视化页面 |
| **来源** | Tableau Metadata API → views |
| **关键属性** | `name`, `view_type`, `path` |
| **上游关联** | Workbook（工作簿）、Field（字段） |

**视图类型**：

- `sheet` - 工作表
- `dashboard` - 仪表板
- `story` - 故事

---

## 模块关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              血缘关系                                        │
└─────────────────────────────────────────────────────────────────────────────┘

     Database ─────┬───────────────────────────────────────┐
         │         │                                       │
         ▼         │                                       │
      Table ───────┼───────────▶ Datasource ──────────────▶ Workbook
         │         │                  │                         │
         ▼         │                  ▼                         ▼
      Column ──────┘              Field ◀──────────────────── View
                                    │
                                    │ (is_calculated=true)
                                    ▼
                                 Metric
```

---

## 当前导航菜单结构

```yaml
资源:
  - 概览 (overview)           # 治理健康度仪表盘
  - 数据库 (databases)        # Database
  - 数据表 (tables)           # Table
  - 字段字典 (fields)         # Field（含维度/度量标记）
  - 指标库 (metrics)          # Metric（从计算字段提取）
  - 数据源 (datasources)      # Datasource
  - 工作簿 (workbooks)        # Workbook
  - 项目 (projects)           # Project
  - 用户 (users)              # TableauUser
```

---

## 字段与指标的关系说明

### 数据流向

```
    所有字段                              指标库
┌─────────────────┐                 ┌─────────────────┐
│     Field       │                 │     Metric      │
├─────────────────┤   提取分析      ├─────────────────┤
│ ● 维度 (Dim)    │ ───────────▶   │ 标准化指标定义   │
│ ● 度量 (Measure)│   仅计算字段    │ 重复检测        │
│ ● 计算字段 (fx) │                 │ 复杂度分析      │
└─────────────────┘                 └─────────────────┘
```

### 典型示例

| 源类型 | 字段名 | 角色 | 是否计算 | 是否进入指标库 |
|--------|--------|------|----------|----------------|
| 数据库列 | 订单日期 | 维度 | ❌ | ❌ |
| 数据库列 | 销售金额 | 度量 | ❌ | ❌ |
| 计算字段 | 利润率 | 度量 | ✅ | ✅ |
| 计算字段 | 年份 | 维度 | ✅ | ❌（维度计算，非指标）|
| 计算字段 | 同比增长率 | 度量 | ✅ | ✅ |

---

## 筛选器说明

### 字段字典筛选

| 筛选项 | 说明 |
|--------|------|
| **角色 (role)** | 度量 / 维度 |
| **类型 (data_type)** | string, integer, real, datetime, boolean |
| **有描述 (hasDescription)** | 是 / 否 |

### 指标库筛选

| 筛选项 | 说明 |
|--------|------|
| **有重复 (hasDuplicate)** | 是 / 否 |

---

*文档版本：1.0*  
*最后更新：2025-12-17*
