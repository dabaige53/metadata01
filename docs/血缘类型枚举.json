{
  "version": "1.0",
  "description": "系统血缘类型枚举 - 完整版",
  "generatedAt": "2025-12-25",
  "summary": {
    "totalLineageTypes": 74,
    "totalModules": 8,
    "totalRelationTables": 6,
    "totalDirectFields": 15,
    "labeledTypes": 8,
    "unlabeledTypes": 66
  },
  "modules": [
    {
      "moduleId": "1",
      "moduleName": "数据库层 (Database)",
      "moduleDescription": "数据库是最上游的元素，是整个血缘链的起点",
      "totalLineageTypes": 3,
      "lineageTypes": [
        {
          "id": "DB-001",
          "name": "数据库包含数据表",
          "source": "Database",
          "target": "Table",
          "direction": "downstream",
          "mechanism": "直接外键",
          "storageType": "直接字段",
          "storageField": "tables.database_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "数据表同步时设置",
          "description": "数据表在存储时直接设置 database_id 指向所属数据库"
        },
        {
          "id": "DB-002",
          "name": "数据库间接关联数据源",
          "source": "Database",
          "target": "Datasource",
          "direction": "downstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "tables.database_id → table_to_datasource",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过表→数据源关联反向推导"
        },
        {
          "id": "DB-003",
          "name": "数据库间接关联工作簿",
          "source": "Database",
          "target": "Workbook",
          "direction": "downstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "多表 JOIN 推导",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过表→数据源→工作簿链路推导"
        }
      ]
    },
    {
      "moduleId": "2",
      "moduleName": "数据表层 (Table)",
      "moduleDescription": "数据表是物理层与逻辑层的桥梁，支持嵌入式表穿透",
      "totalLineageTypes": 8,
      "lineageTypes": [
        {
          "id": "TBL-001",
          "name": "表归属数据库",
          "source": "Table",
          "target": "Database",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "tables.database_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "数据表同步时",
          "description": "Tableau API 返回表信息中包含 database.id"
        },
        {
          "id": "TBL-002",
          "name": "表被数据源引用",
          "source": "Table",
          "target": "Datasource",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "table_to_datasource",
          "isLabeled": true,
          "labelField": "relationship_type",
          "labelValues": ["upstream", "source", "reference"],
          "buildTiming": "数据源同步时",
          "description": "从数据源的 upstreamTables 获取并插入关联记录"
        },
        {
          "id": "TBL-003",
          "name": "表包含原始列",
          "source": "Table",
          "target": "DBColumn",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "db_columns.table_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "数据表同步时同步列",
          "description": "表和列嵌套在一起从 API 获取"
        },
        {
          "id": "TBL-004",
          "name": "物理表类型标识",
          "source": "Table",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "tables.table_type (从 __typename 转化)",
          "isLabeled": true,
          "labelField": "__typename / table_type",
          "labelValues": ["DatabaseTable", "EmbeddedTable", "CustomSQLTable", "VirtualConnectionTable"],
          "buildTiming": "数据表同步时",
          "description": "Tableau API 返回的表类型标识"
        },
        {
          "id": "TBL-005",
          "name": "嵌入式表标记",
          "source": "Table",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "tables.is_embedded",
          "isLabeled": true,
          "labelField": "is_embedded",
          "labelValues": ["0 (物理表)", "1 (嵌入式表)"],
          "buildTiming": "数据表同步时",
          "description": "根据 API 返回的 isEmbedded 或 __typename 判断"
        },
        {
          "id": "TBL-006",
          "name": "嵌入式表上游穿透",
          "source": "EmbeddedTable/CustomSQLTable",
          "target": "DatabaseTable",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "内存推导(不持久化)",
          "storageField": "table.upstreamTables",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时使用",
          "description": "嵌入式表的 upstreamTables 指向上游物理表，用于穿透但不持久化"
        },
        {
          "id": "TBL-007",
          "name": "表间接关联字段",
          "source": "Table",
          "target": "Field",
          "direction": "downstream",
          "mechanism": "直接外键",
          "storageType": "直接字段",
          "storageField": "fields.table_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "字段设置 table_id 指向关联的表"
        },
        {
          "id": "TBL-008",
          "name": "表间接关联工作簿",
          "source": "Table",
          "target": "Workbook",
          "direction": "downstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "table_to_datasource → datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过数据源关联间接查询"
        }
      ]
    },
    {
      "moduleId": "3",
      "moduleName": "原始列层 (DBColumn)",
      "moduleDescription": "原始列是数据库物理列，代表数据最小物理单元",
      "totalLineageTypes": 5,
      "lineageTypes": [
        {
          "id": "COL-001",
          "name": "列归属数据表",
          "source": "DBColumn",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "db_columns.table_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "数据表同步时同步列",
          "description": "列信息嵌套在表信息中一起返回"
        },
        {
          "id": "COL-002",
          "name": "列被字段引用",
          "source": "DBColumn",
          "target": "Field",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.upstream_column_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "从字段的 upstreamColumns[0] 获取"
        },
        {
          "id": "COL-003",
          "name": "列间接关联数据库",
          "source": "DBColumn",
          "target": "Database",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "db_columns.table_id → tables.database_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过表间接获取数据库"
        },
        {
          "id": "COL-004",
          "name": "缺失列自动补全",
          "source": "System",
          "target": "DBColumn",
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "动态创建",
          "storageField": "db_columns",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时发现缺失",
          "description": "当字段引用的列不存在时，系统自动创建缺失记录"
        },
        {
          "id": "COL-005",
          "name": "列数据类型标识",
          "source": "DBColumn",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "db_columns.remote_type",
          "isLabeled": true,
          "labelField": "remote_type",
          "labelValues": ["VARCHAR", "NUMBER", "DATE", "BOOLEAN", "..."],
          "buildTiming": "数据表同步时",
          "description": "数据库原生数据类型标识"
        }
      ]
    },
    {
      "moduleId": "4",
      "moduleName": "数据源层 (Datasource)",
      "moduleDescription": "数据源是 Tableau 语义层，分为已发布和嵌入式两种",
      "totalLineageTypes": 10,
      "lineageTypes": [
        {
          "id": "DS-001",
          "name": "数据源引用数据表",
          "source": "Datasource",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "table_to_datasource",
          "isLabeled": true,
          "labelField": "relationship_type",
          "labelValues": ["upstream"],
          "buildTiming": "数据源同步时",
          "description": "从 upstreamTables 获取并建立关联"
        },
        {
          "id": "DS-002",
          "name": "数据源被工作簿使用",
          "source": "Datasource",
          "target": "Workbook",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "从工作簿的 upstreamDatasources 获取"
        },
        {
          "id": "DS-003",
          "name": "数据源包含字段",
          "source": "Datasource",
          "target": "Field",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.datasource_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "字段设置 datasource_id 指向所属数据源"
        },
        {
          "id": "DS-004",
          "name": "嵌入式/已发布标识",
          "source": "Datasource",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "datasources.is_embedded",
          "isLabeled": true,
          "labelField": "is_embedded",
          "labelValues": ["0 (已发布)", "1 (嵌入式)"],
          "buildTiming": "数据源同步时",
          "description": "标识数据源是否为嵌入式"
        },
        {
          "id": "DS-005",
          "name": "穿透型嵌入源→发布源",
          "source": "EmbeddedDatasource",
          "target": "PublishedDatasource",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "datasources.source_published_datasource_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时处理嵌入源",
          "description": "穿透型嵌入源指向其上游的已发布数据源"
        },
        {
          "id": "DS-006",
          "name": "独立直连型嵌入源标识",
          "source": "EmbeddedDatasource",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "推导判断",
          "storageField": "upstreamDatasources 为空",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时判断",
          "description": "无 upstreamDatasources 的嵌入源为独立直连型"
        },
        {
          "id": "DS-007",
          "name": "穿透型嵌入源双重关联",
          "source": "EmbeddedDatasource + PublishedDatasource",
          "target": "Workbook",
          "direction": "downstream",
          "mechanism": "系统规则",
          "storageType": "关联表(双条记录)",
          "storageField": "datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "穿透型嵌入源会建立两条关联：发布源→工作簿 + 嵌入源→工作簿"
        },
        {
          "id": "DS-008",
          "name": "独立直连型嵌入源表关联",
          "source": "EmbeddedDatasource",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "table_to_datasource",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "独立直连型直接建立到上游表的关联"
        },
        {
          "id": "DS-009",
          "name": "数据源间接关联数据库",
          "source": "Datasource",
          "target": "Database",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "table_to_datasource → tables.database_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过表间接获取数据库"
        },
        {
          "id": "DS-010",
          "name": "认证状态标识",
          "source": "Datasource",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "datasources.is_certified",
          "isLabeled": true,
          "labelField": "is_certified",
          "labelValues": ["0 (未认证)", "1 (已认证)"],
          "buildTiming": "数据源同步时",
          "description": "Tableau 认证标识"
        }
      ]
    },
    {
      "moduleId": "5",
      "moduleName": "工作簿层 (Workbook)",
      "moduleDescription": "工作簿是 Tableau 报表容器",
      "totalLineageTypes": 6,
      "lineageTypes": [
        {
          "id": "WB-001",
          "name": "工作簿使用已发布数据源",
          "source": "Workbook",
          "target": "Datasource (Published)",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "从 upstreamDatasources 获取"
        },
        {
          "id": "WB-002",
          "name": "工作簿包含嵌入式数据源",
          "source": "Workbook",
          "target": "Datasource (Embedded)",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "从 embeddedDatasources 获取并保存"
        },
        {
          "id": "WB-003",
          "name": "工作簿包含视图",
          "source": "Workbook",
          "target": "View",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "views.workbook_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "视图设置 workbook_id 指向所属工作簿"
        },
        {
          "id": "WB-004",
          "name": "工作簿间接关联字段",
          "source": "Workbook",
          "target": "Field",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "直接字段+推导",
          "storageField": "fields.workbook_id 或 datasource_to_workbook",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "多途径",
          "description": "嵌入式字段直接设置 workbook_id，发布式字段通过数据源关联推导"
        },
        {
          "id": "WB-005",
          "name": "工作簿间接关联数据表",
          "source": "Workbook",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "datasource_to_workbook → table_to_datasource",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过数据源反向查询表"
        },
        {
          "id": "WB-006",
          "name": "工作簿间接关联数据库",
          "source": "Workbook",
          "target": "Database",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "多表 JOIN",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过 数据源→表→数据库 链路推导"
        }
      ]
    },
    {
      "moduleId": "6",
      "moduleName": "视图层 (View)",
      "moduleDescription": "视图是用户最终看到的报表页面，分为 Sheet 和 Dashboard",
      "totalLineageTypes": 8,
      "lineageTypes": [
        {
          "id": "VIEW-001",
          "name": "视图归属工作簿",
          "source": "View",
          "target": "Workbook",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "views.workbook_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "视图嵌套在工作簿信息中一起返回"
        },
        {
          "id": "VIEW-002",
          "name": "视图类型标识",
          "source": "View",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "views.view_type",
          "isLabeled": true,
          "labelField": "view_type",
          "labelValues": ["sheet", "dashboard"],
          "buildTiming": "工作簿同步时",
          "description": "区分图表和仪表板"
        },
        {
          "id": "VIEW-003",
          "name": "仪表板包含图表",
          "source": "Dashboard",
          "target": "Sheet",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "dashboard_to_sheet",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "工作簿同步时",
          "description": "仪表板的 sheets 列表保存到关联表"
        },
        {
          "id": "VIEW-004",
          "name": "视图使用字段",
          "source": "View",
          "target": "Field",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "field_to_view",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "视图字段关联同步时",
          "description": "从 sheetFieldInstances 获取并建立关联"
        },
        {
          "id": "VIEW-005",
          "name": "视图字段智能重连",
          "source": "View",
          "target": "Field (重定向)",
          "direction": "upstream",
          "mechanism": "系统推导",
          "storageType": "关联表",
          "storageField": "field_to_view",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "视图字段关联同步时",
          "description": "当原字段 ID 无效时，智能查找同名发布式字段进行重连"
        },
        {
          "id": "VIEW-006",
          "name": "视图间接关联数据源",
          "source": "View",
          "target": "Datasource",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "field_to_view → fields.datasource_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过使用的字段反向获取数据源"
        },
        {
          "id": "VIEW-007",
          "name": "视图访问量累加（仪表板→图表）",
          "source": "Dashboard",
          "target": "Sheet",
          "direction": "downstream",
          "mechanism": "系统规则",
          "storageType": "直接字段",
          "storageField": "views.total_view_count",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "访问统计同步后",
          "description": "仪表板的访问量会累加到其包含的图表上"
        },
        {
          "id": "VIEW-008",
          "name": "视图访问统计历史",
          "source": "View",
          "target": "ViewUsageHistory",
          "direction": "downstream",
          "mechanism": "REST API",
          "storageType": "直接字段",
          "storageField": "view_usage_history",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "访问统计同步时",
          "description": "每次同步记录一条历史快照"
        }
      ]
    },
    {
      "moduleId": "7",
      "moduleName": "字段层 (Field)",
      "moduleDescription": "字段是血缘链路的核心，支持多重去重和关联",
      "totalLineageTypes": 18,
      "lineageTypes": [
        {
          "id": "FLD-001",
          "name": "字段归属数据源",
          "source": "Field",
          "target": "Datasource",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.datasource_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "字段设置 datasource_id 指向所属数据源"
        },
        {
          "id": "FLD-002",
          "name": "字段关联数据表",
          "source": "Field",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "API直接返回+穿透",
          "storageType": "直接字段",
          "storageField": "fields.table_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "从 upstreamColumns[0].table 获取，支持嵌入式表穿透"
        },
        {
          "id": "FLD-003",
          "name": "字段对应原始列",
          "source": "Field",
          "target": "DBColumn",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.upstream_column_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "从 upstreamColumns[0] 获取"
        },
        {
          "id": "FLD-004",
          "name": "字段归属工作簿（嵌入式）",
          "source": "Field",
          "target": "Workbook",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.workbook_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "嵌入式字段直接设置 workbook_id"
        },
        {
          "id": "FLD-005",
          "name": "字段类型标识",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "__typename",
          "isLabeled": true,
          "labelField": "__typename",
          "labelValues": ["ColumnField", "CalculatedField", "DatasourceField", "GroupField"],
          "buildTiming": "字段同步时",
          "description": "Tableau API 返回的字段类型"
        },
        {
          "id": "FLD-006",
          "name": "计算字段标识",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.is_calculated",
          "isLabeled": true,
          "labelField": "is_calculated",
          "labelValues": ["0 (普通字段)", "1 (计算字段)"],
          "buildTiming": "字段同步时",
          "description": "区分普通字段和计算字段"
        },
        {
          "id": "FLD-007",
          "name": "字段被视图使用",
          "source": "Field",
          "target": "View",
          "direction": "downstream",
          "mechanism": "API直接返回",
          "storageType": "关联表",
          "storageField": "field_to_view",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "视图字段关联同步时",
          "description": "从 sheetFieldInstances 获取"
        },
        {
          "id": "FLD-008",
          "name": "嵌入式字段→发布式字段穿透",
          "source": "Field (Embedded)",
          "target": "Field (Published)",
          "direction": "upstream",
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.remote_field_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "嵌入式字段指向其来源的已发布字段"
        },
        {
          "id": "FLD-009",
          "name": "字段一级去重缓存（数据源+名称）",
          "source": "System",
          "target": null,
          "direction": null,
          "mechanism": "系统规则",
          "storageType": "内存缓存",
          "storageField": "published_field_cache",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "识别穿透型嵌入式字段副本，避免重复保存"
        },
        {
          "id": "FLD-010",
          "name": "字段二级去重缓存（物理表+列）",
          "source": "System",
          "target": null,
          "direction": null,
          "mechanism": "系统规则",
          "storageType": "内存缓存",
          "storageField": "physical_column_cache",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "识别独立直连型嵌入式字段副本，物理层去重"
        },
        {
          "id": "FLD-011",
          "name": "字段完整血缘预计算",
          "source": "Field",
          "target": "Table + Datasource + Workbook",
          "direction": "bidirectional",
          "mechanism": "系统推导",
          "storageType": "预计算表",
          "storageField": "field_full_lineage",
          "isLabeled": true,
          "labelField": "lineage_type",
          "labelValues": ["direct", "indirect"],
          "buildTiming": "同步完成后计算",
          "description": "预计算字段的完整血缘链，包含直接/间接标识"
        },
        {
          "id": "FLD-012",
          "name": "字段角色标识",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.role",
          "isLabeled": true,
          "labelField": "role",
          "labelValues": ["dimension", "measure"],
          "buildTiming": "字段同步时",
          "description": "区分维度和度量"
        },
        {
          "id": "FLD-013",
          "name": "字段隐藏标识",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "API直接返回",
          "storageType": "直接字段",
          "storageField": "fields.is_hidden",
          "isLabeled": true,
          "labelField": "is_hidden",
          "labelValues": ["0 (可见)", "1 (隐藏)"],
          "buildTiming": "字段同步时",
          "description": "是否在 Tableau 中隐藏"
        },
        {
          "id": "FLD-014",
          "name": "字段间接关联数据库",
          "source": "Field",
          "target": "Database",
          "direction": "upstream",
          "mechanism": "推导计算",
          "storageType": "跨表查询",
          "storageField": "fields.table_id → tables.database_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "查询时推导",
          "description": "通过表间接获取数据库"
        },
        {
          "id": "FLD-015",
          "name": "表名匹配兜底关联",
          "source": "Field",
          "target": "Table",
          "direction": "upstream",
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "fields.table_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时",
          "description": "当 API 不返回 upstreamColumns 时，通过字段名匹配表名"
        },
        {
          "id": "FLD-016",
          "name": "原始列自动补全",
          "source": "System",
          "target": "Field → DBColumn",
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "动态创建",
          "storageField": "db_columns + tables",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "字段同步时发现缺失",
          "description": "自动创建缺失的物理列和表记录"
        },
        {
          "id": "FLD-017",
          "name": "字段使用统计（视图使用次数）",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "fields.usage_count",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "统计计算时",
          "description": "通过 field_to_view 统计字段被使用次数"
        },
        {
          "id": "FLD-018",
          "name": "字段被指标引用统计",
          "source": "Field",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "fields.metric_usage_count",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "统计计算时",
          "description": "通过 field_dependencies 统计被引用次数"
        }
      ]
    },
    {
      "moduleId": "8",
      "moduleName": "计算字段/指标层 (CalculatedField/Metric)",
      "moduleDescription": "计算字段是用户用公式创建的派生字段，支持依赖分析和重复检测",
      "totalLineageTypes": 16,
      "lineageTypes": [
        {
          "id": "CALC-001",
          "name": "计算字段依赖基础字段",
          "source": "CalculatedField",
          "target": "Field",
          "direction": "upstream",
          "mechanism": "API直接返回+公式解析",
          "storageType": "关联表",
          "storageField": "field_dependencies",
          "isLabeled": true,
          "labelField": "dependency_type",
          "labelValues": ["formula", "filter", "parameter"],
          "buildTiming": "血缘同步时",
          "description": "解析公式中的 [字段名] 引用并建立依赖"
        },
        {
          "id": "CALC-002",
          "name": "计算字段嵌套依赖",
          "source": "CalculatedField",
          "target": "CalculatedField",
          "direction": "upstream",
          "mechanism": "公式解析",
          "storageType": "关联表",
          "storageField": "field_dependencies",
          "isLabeled": true,
          "labelField": "dependency_type",
          "labelValues": ["formula"],
          "buildTiming": "血缘同步时",
          "description": "计算字段引用另一个计算字段"
        },
        {
          "id": "CALC-003",
          "name": "计算字段扩展信息",
          "source": "Field (is_calculated=1)",
          "target": "CalculatedField",
          "direction": "downstream",
          "mechanism": "系统规则",
          "storageType": "扩展表",
          "storageField": "calculated_fields",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "计算字段同步时",
          "description": "保存公式、复杂度、重复检测等扩展信息"
        },
        {
          "id": "CALC-004",
          "name": "公式哈希重复检测",
          "source": "CalculatedField",
          "target": "CalculatedField (duplicate)",
          "direction": "bidirectional",
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "calculated_fields.formula_hash + has_duplicates",
          "isLabeled": true,
          "labelField": "has_duplicates",
          "labelValues": ["0 (唯一)", "1 (有重复)"],
          "buildTiming": "统计计算时",
          "description": "通过 formula_hash 识别相同公式的重复指标"
        },
        {
          "id": "CALC-005",
          "name": "计算字段复杂度评分",
          "source": "CalculatedField",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "calculated_fields.complexity_score",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "统计计算时",
          "description": "基于公式长度、嵌套深度等计算复杂度"
        },
        {
          "id": "CALC-006",
          "name": "计算字段依赖数统计",
          "source": "CalculatedField",
          "target": null,
          "direction": null,
          "mechanism": "系统推导",
          "storageType": "直接字段",
          "storageField": "calculated_fields.dependency_count",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "血缘同步时",
          "description": "统计公式中引用的字段数量"
        },
        {
          "id": "CALC-007",
          "name": "指标变体关联",
          "source": "Metric",
          "target": "MetricVariant",
          "direction": "downstream",
          "mechanism": "治理规则",
          "storageType": "关联表",
          "storageField": "metric_variants",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "治理操作时",
          "description": "标准指标与其变体的关联"
        },
        {
          "id": "CALC-008",
          "name": "指标重复检测",
          "source": "Metric",
          "target": "Metric (duplicate)",
          "direction": "bidirectional",
          "mechanism": "治理规则",
          "storageType": "关联表",
          "storageField": "metric_duplicates",
          "isLabeled": true,
          "labelField": "detection_method",
          "labelValues": ["hash", "semantic", "manual"],
          "buildTiming": "治理操作时",
          "description": "记录重复指标对及其检测方式"
        },
        {
          "id": "CALC-009",
          "name": "指标状态标识",
          "source": "Metric",
          "target": null,
          "direction": null,
          "mechanism": "治理规则",
          "storageType": "直接字段",
          "storageField": "metrics.status",
          "isLabeled": true,
          "labelField": "status",
          "labelValues": ["active", "review", "deprecated", "duplicate"],
          "buildTiming": "治理操作时",
          "description": "指标生命周期状态"
        },
        {
          "id": "CALC-010",
          "name": "指标类型标识",
          "source": "Metric",
          "target": null,
          "direction": null,
          "mechanism": "治理规则",
          "storageType": "直接字段",
          "storageField": "metrics.metric_type",
          "isLabeled": true,
          "labelField": "metric_type",
          "labelValues": ["KPI", "Calculated", "Ratio"],
          "buildTiming": "治理操作时",
          "description": "指标业务类型分类"
        },
        {
          "id": "CALC-011",
          "name": "分表-常规字段实例→去重字段",
          "source": "RegularField (instance)",
          "target": "UniqueRegularField",
          "direction": "upstream",
          "mechanism": "去重逻辑",
          "storageType": "直接字段",
          "storageField": "regular_fields.unique_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "分表同步时",
          "description": "实例字段指向去重后的唯一字段"
        },
        {
          "id": "CALC-012",
          "name": "分表-计算字段实例→去重指标",
          "source": "CalculatedField (instance)",
          "target": "UniqueCalculatedField",
          "direction": "upstream",
          "mechanism": "去重逻辑",
          "storageType": "直接字段",
          "storageField": "calculated_fields.unique_id",
          "isLabeled": false,
          "labelField": null,
          "labelValues": [],
          "buildTiming": "分表同步时",
          "description": "实例字段指向去重后的唯一指标"
        },
        {
          "id": "CALC-013",
          "name": "分表-常规字段完整血缘",
          "source": "RegularField",
          "target": "Table + Datasource + Workbook",
          "direction": "bidirectional",
          "mechanism": "系统推导",
          "storageType": "预计算表",
          "storageField": "regular_field_full_lineage",
          "isLabeled": true,
          "labelField": "lineage_type",
          "labelValues": ["direct", "indirect"],
          "buildTiming": "同步完成后计算",
          "description": "常规字段的完整血缘预计算"
        },
        {
          "id": "CALC-014",
          "name": "分表-计算字段完整血缘",
          "source": "CalculatedField",
          "target": "Table + Datasource + Workbook",
          "direction": "bidirectional",
          "mechanism": "系统推导",
          "storageType": "预计算表",
          "storageField": "calc_field_full_lineage",
          "isLabeled": true,
          "labelField": "lineage_type",
          "labelValues": ["direct", "indirect"],
          "buildTiming": "同步完成后计算",
          "description": "计算字段的完整血缘预计算"
        },
        {
          "id": "CALC-015",
          "name": "分表-计算字段依赖常规字段",
          "source": "CalculatedField",
          "target": "RegularField",
          "direction": "upstream",
          "mechanism": "公式解析",
          "storageType": "关联表",
          "storageField": "calc_field_dependencies",
          "isLabeled": true,
          "labelField": "dependency_type",
          "labelValues": ["formula"],
          "buildTiming": "血缘同步时",
          "description": "分表架构下的依赖关系"
        },
        {
          "id": "CALC-016",
          "name": "分表-计算字段依赖计算字段",
          "source": "CalculatedField",
          "target": "CalculatedField",
          "direction": "upstream",
          "mechanism": "公式解析",
          "storageType": "关联表",
          "storageField": "calc_field_dependencies",
          "isLabeled": true,
          "labelField": "dependency_type",
          "labelValues": ["formula"],
          "buildTiming": "血缘同步时",
          "description": "分表架构下的嵌套依赖"
        }
      ]
    }
  ],
  "labelingSummary": {
    "labeledFields": [
      {
        "fieldPath": "table_to_datasource.relationship_type",
        "labelValues": ["upstream", "source", "reference"],
        "usage": "标识表与数据源的关系类型"
      },
      {
        "fieldPath": "field_dependencies.dependency_type",
        "labelValues": ["formula", "filter", "parameter"],
        "usage": "标识字段依赖的来源类型"
      },
      {
        "fieldPath": "field_full_lineage.lineage_type",
        "labelValues": ["direct", "indirect"],
        "usage": "标识血缘是直接关联还是间接推导"
      },
      {
        "fieldPath": "tables.is_embedded",
        "labelValues": ["0", "1"],
        "usage": "标识是物理表还是嵌入式表"
      },
      {
        "fieldPath": "datasources.is_embedded",
        "labelValues": ["0", "1"],
        "usage": "标识是已发布还是嵌入式数据源"
      },
      {
        "fieldPath": "fields.is_calculated",
        "labelValues": ["0", "1"],
        "usage": "标识是普通字段还是计算字段"
      },
      {
        "fieldPath": "views.view_type",
        "labelValues": ["sheet", "dashboard"],
        "usage": "标识是图表还是仪表板"
      },
      {
        "fieldPath": "calculated_fields.has_duplicates",
        "labelValues": ["0", "1"],
        "usage": "标识是否有公式重复的指标"
      }
    ],
    "missingLabels": [
      {
        "scenario": "血缘建立时机",
        "description": "未记录血缘是在哪个同步阶段建立的",
        "suggestion": "增加 lineage_created_at 或 sync_phase 字段"
      },
      {
        "scenario": "血缘来源机制",
        "description": "未区分血缘是 API 直接返回还是系统推导计算",
        "suggestion": "增加 lineage_source 字段 (api/derived/computed)"
      },
      {
        "scenario": "穿透成功/失败状态",
        "description": "嵌入式表穿透结果未持久化标签",
        "suggestion": "增加 penetration_status 字段 (success/failed/partial)"
      },
      {
        "scenario": "去重/重连操作留痕",
        "description": "字段去重和视图重连操作未留下审计日志",
        "suggestion": "增加 dedup_action 或 reconnect_log"
      },
      {
        "scenario": "血缘完整性评分",
        "description": "未对每条血缘链的完整性进行评估",
        "suggestion": "增加 lineage_completeness 字段 (complete/partial/broken)"
      },
      {
        "scenario": "血缘变更历史",
        "description": "血缘关系变更未记录历史",
        "suggestion": "增加血缘变更日志表 lineage_change_log"
      }
    ]
  },
  "recommendations": [
    {
      "priority": "HIGH",
      "title": "增加血缘来源标签",
      "description": "在所有关联表中增加 lineage_source 字段，区分 API 返回、系统推导、预计算等不同来源",
      "affectedTables": ["table_to_datasource", "datasource_to_workbook", "field_to_view", "field_dependencies"]
    },
    {
      "priority": "HIGH",
      "title": "增加穿透状态持久化",
      "description": "在 fields 表中增加 penetration_status 字段，记录嵌入式表穿透的结果",
      "affectedTables": ["fields", "regular_fields"]
    },
    {
      "priority": "MEDIUM",
      "title": "增加血缘完整性评分",
      "description": "在血缘预计算表中增加 completeness 字段，评估血缘链的完整程度",
      "affectedTables": ["field_full_lineage", "regular_field_full_lineage", "calc_field_full_lineage"]
    },
    {
      "priority": "MEDIUM",
      "title": "建立血缘变更日志",
      "description": "创建 lineage_change_log 表，记录每次同步时血缘关系的变更",
      "affectedTables": ["(new) lineage_change_log"]
    },
    {
      "priority": "LOW",
      "title": "增加去重操作审计",
      "description": "在字段去重和视图重连时记录操作日志",
      "affectedTables": ["(new) dedup_audit_log"]
    }
  ]
}
