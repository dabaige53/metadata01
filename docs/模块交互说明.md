# Tableau 元数据治理平台：模块交互业务说明

## 概述

本文档从**业务视角**详细说明平台中各个模块的功能定位、获取的信息内容、以及与其他模块之间的交互关系。

---

## 一、宏观架构：五大核心模块

平台将 Tableau 的元数据资产按照数据流向组织为五层结构：

|    层级    |  模块  | 业务定位             | 核心问题             |
| :--------: | :----: | :------------------- | :------------------- |
| **物理层** | 数据库 | 底层数据存储的入口   | "数据从哪来？"       |
| **物理层** | 数据表 | 具体的数据结构定义   | "有哪些可用的数据？" |
| **逻辑层** | 数据源 | 业务逻辑的封装与复用 | "数据如何被加工？"   |
| **展示层** | 工作簿 | 报表的组织容器       | "报表归属于谁？"     |
| **展示层** |  视图  | 最终用户看到的报表   | "用户在看什么？"     |

---

## 二、各模块详细业务说明

### 1. 数据库 (Database)

**业务定位**：代表一个物理数据库连接，是血缘追溯的**起点**。

**可获取信息**：
| 信息项   | 说明                                    |
| :------- | :-------------------------------------- |
| 连接类型 | Snowflake、Oracle、SQL Server、Excel 等 |
| 主机地址 | 数据库服务器位置                        |
| 认证状态 | 是否经过数据治理团队认证                |
| 表数量   | 该数据库下有多少张表                    |

**与其他模块的关系**：
| 方向  | 关联模块 | 关系类型 | 业务含义             |
| :---: | :------: | :------: | :------------------- |
| 下游  |  数据表  |  一对多  | 一个数据库包含多张表 |

**产品界面展示**：

*列表页显示字段*：
| 字段名     | 显示位置 | 说明                     |
| :--------- | :------- | :----------------------- |
| 数据库名称 | 主标题   | 可点击进入详情           |
| 连接类型   | 标签     | 如 "Snowflake"、"Oracle" |
| 表数量     | 统计数字 | 包含的物理表总数         |
| 数据源数量 | 统计数字 | 关联的下游数据源数       |
| 字段总数   | 统计数字 | 所有表的字段汇总         |

*详情面板 Tab 页*：
| Tab 名称 | 显示条件   | 内容说明                                 | 可交互操作       |
| :------- | :--------- | :--------------------------------------- | :--------------- |
| 概览     | 始终显示   | 基础属性、认证状态、创建/更新时间        | 无               |
| 数据表   | 有下属表时 | 表名、Schema、字段数、列数、数据源关联数 | 点击跳转至表详情 |
| 血缘图   | 始终显示   | Mermaid 格式的可视化血缘路径             | 加载渲染         |

---

### 2. 数据表 (Table)

**业务定位**：记录具体的物理表结构，是物理层与逻辑层的**桥梁**。

**可获取信息**：
| 信息项   | 说明                                |
| :------- | :---------------------------------- |
| Schema   | 表所属的数据库模式 (如 dbo, public) |
| 原始列   | 数据库中实际的物理列定义            |
| 关联字段 | Tableau 中基于此表创建的逻辑字段    |
| 使用状态 | 是否被数据源引用 (孤立表治理)       |

**与其他模块的关系**：
| 方向  | 关联模块 |  关系类型  | 业务含义                                         |
| :---: | :------: | :--------: | :----------------------------------------------- |
| 上游  |  数据库  |   多对一   | 每张表归属于一个数据库                           |
| 下游  |  数据源  | **多对多** | 一张表可被多个数据源复用；一个数据源可合并多张表 |

**产品界面展示**：

*列表页显示字段*：
| 字段名     | 显示位置    | 说明                            |
| :--------- | :---------- | :------------------------------ |
| 表名       | 主标题      | 可点击进入详情                  |
| Schema     | 副标题/标签 | 数据库模式名                    |
| 所属数据库 | 副标题      | 关联的数据库名称                |
| 原始列数   | 统计数字    | 物理列数量                      |
| 字段数     | 统计数字    | Tableau 逻辑字段数量            |
| 数据源数   | 统计数字    | 被多少数据源引用                |
| 工作簿数   | 统计数字    | 间接关联的工作簿数              |
| 使用状态   | 状态标签    | "使用中" / "仅关联" / "孤立"    |
| 预览字段   | 标签组      | 度量字段 (N个) / 维度字段 (M个) |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件 | 内容说明                                   | 可交互操作           |
| :--------- | :------- | :----------------------------------------- | :------------------- |
| 概览       | 始终显示 | 基础属性、Schema、表类型、认证状态         | 无                   |
| 所属数据库 | 有关联时 | 数据库名、连接类型、主机地址               | 点击跳转至数据库详情 |
| 原始列     | 有列时   | 列名、数据类型、是否可空、认证状态         | 点击查看列详情       |
| 包含字段   | 有字段时 | Tableau 字段名、数据类型、角色、被引用情况 | 点击跳转至字段详情   |
| 关联数据源 | 有关联时 | 数据源名、项目、所有者、认证状态、是否提取 | 点击跳转至数据源详情 |
| 血缘图     | 始终显示 | Mermaid 格式的可视化血缘路径               | 加载渲染             |

---

### 3. 数据源 (Datasource)

**业务定位**：Tableau 的**语义层**，是数据建模和复用的核心。

**可获取信息**：
| 信息项   | 说明                             |
| :------- | :------------------------------- |
| 提取状态 | 是实时连接还是数据提取 (Extract) |
| 刷新时间 | 最近一次数据更新时间             |
| 认证状态 | 是否为官方认证的权威数据源       |
| 包含字段 | 该数据源定义的所有维度和度量     |
| 计算指标 | 基于字段创建的计算公式           |

**与其他模块的关系**：
| 方向  | 关联模块 |  关系类型  | 业务含义                   |
| :---: | :------: | :--------: | :------------------------- |
| 上游  |  数据表  | **多对多** | 数据源可以 JOIN 多张物理表 |
| 下游  |  工作簿  | **多对多** | 数据源可被多个工作簿引用   |

**业务价值**：
- 通过认证数据源减少重复建设
- 统一指标口径，确保数据一致性

**产品界面展示**：

*列表页显示字段*：
| 字段名      | 显示位置 | 说明                             |
| :---------- | :------- | :------------------------------- |
| 数据源名称  | 主标题   | 可点击进入详情                   |
| 项目        | 副标题   | 所属 Tableau 项目                |
| 认证状态    | 标签     | "已认证" (绿色徽章) / 未认证     |
| 连接模式    | 标签     | "Extract" (提取) / "Live" (实时) |
| 上次刷新    | 副标题   | 提取刷新的最后时间点             |
| 表数量      | 统计数字 | 关联的物理表数量                 |
| 字段/指标数 | 统计数字 | 包含的维度、度量及计算指标总数   |
| 工作簿数    | 统计数字 | 被下游引用的工作簿数量           |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件 | 内容说明                               | 可交互操作           |
| :--------- | :------- | :------------------------------------- | :------------------- |
| 概览       | 始终显示 | 基础属性、认证信息、刷新计划、所有者   | 无                   |
| 原始表     | 有关联时 | 物理表名、Schema、数据库信息           | 点击跳转至表详情     |
| 包含字段   | 始终显示 | 维度列表、度量列表、数据类型、隐藏状态 | 点击跳转至字段详情   |
| 包含指标   | 有指标时 | 计算字段、KPI 指标、公式预览           | 点击跳转至指标详情   |
| 关联工作簿 | 有关联时 | 工作簿名、项目、所有者、访问热度       | 点击跳转至工作簿详情 |
| 血缘图     | 始终显示 | Mermaid 格式的可视化血缘路径           | 加载渲染             |

---

### 4. 工作簿 (Workbook)

**业务定位**：Tableau 的报表**容器**，按主题组织多个视图。

**可获取信息**：
| 信息项   | 说明                             |
| :------- | :------------------------------- |
| 所有者   | 工作簿的创建者/负责人            |
| 项目归属 | 工作簿发布到的 Tableau 项目      |
| 视图列表 | 包含的 Sheet 和 Dashboard        |
| 使用情况 | 该工作簿下所有视图的访问热度汇总 |

**与其他模块的关系**：
| 方向  | 关联模块 |  关系类型  | 业务含义                   |
| :---: | :------: | :--------: | :------------------------- |
| 上游  |  数据源  | **多对多** | 一个工作簿可连接多个数据源 |
| 下游  |   视图   |   一对多   | 工作簿包含多个视图         |

**产品界面展示**：

*列表页显示字段*：
| 字段名     | 显示位置      | 说明                  |
| :--------- | :------------ | :-------------------- |
| 工作簿名称 | 主标题        | 可点击进入详情        |
| 项目       | 副标题        | 所属 Tableau 项目     |
| 所有者     | 副标题 + 头像 | 责任人信息            |
| 视图数     | 统计数字      | 包含的图表和看板总数  |
| 数据源数   | 统计数字      | 连接的上游数据源数量  |
| 使用字段数 | 统计数字      | 实际引用的字段总数    |
| 访问热度   | 热度条/数字   | 近 30 天总浏览量      |
| 最后修改   | 时间标签      | 最近一次发布/编辑时间 |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件 | 内容说明                            | 可交互操作           |
| :--------- | :------- | :---------------------------------- | :------------------- |
| 概览       | 始终显示 | 基础属性、项目路径、所有者、描述    | 无                   |
| 视图/看板  | 始终显示 | 包含的 Sheets 列表、Dashboards 列表 | 点击跳转至视图详情   |
| 使用数据源 | 有关联时 | 数据源名、认证状态、连接类型        | 点击跳转至数据源详情 |
| 使用字段   | 有使用时 | 字段名、类型、来自哪个数据源/表     | 点击跳转至字段详情   |
| 使用指标   | 有使用时 | 指标名、公式、复杂度                | 点击跳转至指标详情   |
| 访问统计   | 始终显示 | 浏览趋势图、历史访问记录            | 无                   |
| 血缘图     | 始终显示 | Mermaid 格式的可视化血缘路径        | 加载渲染             |

---

### 5. 视图 (View)

**业务定位**：用户最终消费数据的**报表界面**，是血缘追溯的**终点**。

**可获取信息**：
| 信息项   | 说明                                   |
| :------- | :------------------------------------- |
| 视图类型 | Sheet (单图表) 或 Dashboard (组合看板) |
| 访问次数 | 用户浏览该报表的总次数                 |
| 使用字段 | 该视图实际引用了哪些字段               |
| 包含视图 | (仅 Dashboard) 组合了哪些 Sheet        |

**与其他模块的关系**：
| 方向  | 关联模块 |  关系类型  | 业务含义                          |
| :---: | :------: | :--------: | :-------------------------------- |
| 上游  |  工作簿  |   多对一   | 视图归属于某个工作簿              |
| 上游  |   字段   | **多对多** | 视图引用多个字段 (用于影响面分析) |

**产品界面展示**：

*列表页显示字段*：
| 字段名      | 显示位置 | 说明                          |
| :---------- | :------- | :---------------------------- |
| 视图名称    | 主标题   | 可点击进入详情                |
| 类型图标    | 图标     | 区分 Sheet 与 Dashboard       |
| 所属工作簿  | 副标题   | 归属的父级容器                |
| 访问量      | 统计数字 | 历史总浏览次数 (Hits Total)   |
| 包含Sheet数 | 统计数字 | (仅对 Dashboard) 包含的图表数 |
| 引用字段数  | 统计数字 | 实际使用的字段总数            |
| 最后更新    | 时间标签 | 最近一次数据同步时间          |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件     | 内容说明                        | 可交互操作            |
| :--------- | :----------- | :------------------------------ | :-------------------- |
| 概览       | 始终显示     | 基础属性、路径、类型、访问统计  | 无                    |
| 包含视图   | 仅 Dashboard | 包含的 Sheets 列表              | 点击跳转至 Sheet 详情 |
| 所属工作簿 | 始终显示     | 工作簿名、项目、所有者          | 点击跳转至工作簿详情  |
| 使用字段   | 有使用时     | 字段名、类型、来自哪个数据源/表 | 点击跳转至字段详情    |
| 使用指标   | 有使用时     | 指标名、公式、复杂度            | 点击跳转至指标详情    |
| 访问统计   | 始终显示     | 包含日/周增量、历史趋势图       | 无                    |
| 血缘图     | 始终显示     | Mermaid 格式的可视化血缘路径    | 加载渲染              |

---

---

### 6. 字段 (Field)

**业务定位**：数据的最小**逻辑单元**，是构建报表和指标的基石。

**可获取信息**：
| 信息项     | 说明                                         |
| :--------- | :------------------------------------------- |
| 显示名称   | 用户在 Tableau 界面看到的字段名 (Caption)    |
| 原始列名   | 对应数据库中的物理列名 (Upstream Column)     |
| 数据类型   | 字符串、整数、浮点数、日期、布尔值等         |
| 角色       | **维度** (分类数据) 或 **度量** (数值数据)   |
| 语义信息   | 默认聚合方式、数字格式 (如百分比/货币)       |
| 完整限定名 | Tableau 内部唯一标识 (如 `[Orders].[Sales]`) |

**与其他模块的关系**：
| 方向  | 关联模块  |  关系类型  | 业务含义                            |
| :---: | :-------: | :--------: | :---------------------------------- |
| 上游  | 数据表/源 |   多对一   | 字段归属于某个表或数据源            |
| 上游  |  原始列   |   一对一   | 逻辑字段映射到物理列 (非计算字段时) |
| 下游  |   指标    |   一对多   | 字段可作为变量被多个公式引用        |
| 下游  |   视图    | **多对多** | 字段被直接拖拽到具体报表中使用      |

**产品界面展示**：

*列表页显示字段*：
| 字段名    | 显示位置 | 说明                                        |
| :-------- | :------- | :------------------------------------------ |
| 字段名称  | 主标题   | 显示名 (Caption) 或 物理名 (Name)           |
| 类型图标  | 图标     | 区分 "Abc"(文本) / "#"(数字) / "📅"(日期) 等 |
| 角色标签  | 标签     | 蓝色(维度) / 绿色(度量)                     |
| 所属表/源 | 副标题   | 来源路径                                    |
| 引用次数  | 统计数字 | 被下游视图和指标引用的总次数                |
| 描述状态  | 图标     | 是否有业务描述 (用于治理)                   |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件 | 内容说明                               | 可交互操作           |
| :--------- | :------- | :------------------------------------- | :------------------- |
| 概览       | 始终显示 | 基础属性、名称层次、语义角色、引用统计 | 无                   |
| 所属数据表 | 有关联时 | 表名、Schema、数据库信息               | 点击跳转至表详情     |
| 关联视图   | 有使用时 | 视图名、工作簿、访问量、类型           | 点击跳转至视图详情   |
| 影响指标   | 有关联时 | 依赖此字段的计算指标列表               | 点击跳转至指标详情   |
| 引用工作簿 | 有关联时 | 包含上述视图的工作簿列表               | 点击跳转至工作簿详情 |
| 血缘图     | 始终显示 | Mermaid 格式的可视化血缘路径           | 加载渲染             |

---

### 7. 指标 (Metric)

**业务定位**：封装了业务逻辑的**计算规则**，保障数据口径的一致性。

**可获取信息**：
| 信息项   | 说明                                   |
| :------- | :------------------------------------- |
| 计算公式 | 具体的 SQL 或 Tableau 计算表达式       |
| 复杂度   | 基于公式长度和函数调用计算的复杂度评分 |
| 依赖字段 | 公式中引用的所有基础字段               |
| 重复情况 | 是否存在公式完全相同的其他指标         |

**与其他模块的关系**：
| 方向  | 关联模块 | 关系类型 | 业务含义                               |
| :---: | :------: | :------: | :------------------------------------- |
| 上游  |   字段   |  多对多  | 一个指标由多个基础字段计算而来         |
| 下游  |   视图   |  多对多  | 指标被拖拽到报表中展示                 |
| 平级  |   指标   |  多对多  | 指标之间可能存在同名或同公式的重复关系 |

**业务价值**：
- **口径管理**：识别重复定义的指标，推动指标标准化
- **变更预警**：基础字段修改前，评估对核心 KPI 的影响

**产品界面展示**：

*列表页显示字段*：
| 字段名   | 显示位置  | 说明                               |
| :------- | :-------- | :--------------------------------- |
| 指标名称 | 主标题    | 业务指标名                         |
| 复杂度   | 标签/评分 | "Low" / "Medium" / "High"          |
| 引用次数 | 统计数字  | 被下游视图引用的热度               |
| 依赖数   | 统计数字  | 公式中涉及的基础字段数量           |
| 重复状态 | 警告标签  | 提示是否存在"同名定义"或"重复公式" |
| 公式预览 | 代码块    | 鼠标悬停显示具体公式               |

*详情面板 Tab 页*：
| Tab 名称   | 显示条件 | 内容说明                             | 可交互操作         |
| :--------- | :------- | :----------------------------------- | :----------------- |
| 概览       | 始终显示 | 基础属性、完整公式(支持复制)、复杂度 | 无                 |
| 同名定义   | 有重复时 | 展示其他数据源中同名同公式的指标     | 点击查看重复指标   |
| 依赖字段   | 始终显示 | 公式中用到的基础字段列表             | 点击跳转至字段详情 |
| 关联视图   | 有使用时 | 视图名、工作簿、访问量               | 点击跳转至视图详情 |
| 所属数据表 | 有关联时 | 定义该指标的表/数据源                | 点击跳转至表详情   |
| 血缘图     | 始终显示 | Mermaid 格式的可视化血缘路径         | 加载渲染           |

---

## 四、典型业务场景

### 场景 1：影响面分析
> "我要修改 `订单日期` 字段的格式，会影响哪些报表？"

**操作路径**：
字段详情 → 关联视图 Tab → 查看所有引用该字段的视图列表

### 场景 2：数据溯源
> "这张报表的数据来自哪个数据库？"

**操作路径**：
视图详情 → 所属工作簿 → 使用数据源 → 原始表 → 所属数据库

### 场景 3：孤立资产治理
> "哪些数据表从来没有被使用过？"

**操作路径**：
数据表模块 → 治理分析 Tab → 未使用表列表

### 场景 4：重复指标发现
> "有多少个数据源定义了相同公式的计算字段？"

**操作路径**：
指标库模块 → 治理分析 Tab → 重复指标分析

---

## 五、数据流图解

请参考配套的 Excalidraw 文件：

📁 `docs/metadata_lineage.excalidraw`

该文件可使用 [Excalidraw](https://excalidraw.com/) 在线编辑器或 VS Code Excalidraw 插件打开查看。
